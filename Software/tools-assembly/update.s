***********************************************************************************************  update   utility  *************************************************************************************************                       versie 2.10*                       8-5-'84**                       Jaron Borensztajn*                       Sarphatipark*                       Amsterdam***                      ===Uitleg===**       Update zorgt voor het updaten van het filesystem*       Hij draait als taak op de achtergrond en doet*       elke x seconden ( updtim ) een update.*       Om de automatische updater even uit te zetten*       kun je hem interrupten. Op een terminate (11) interrupt,*       reageert update door in suspended mode te gaan;*       hij onderbreekt het updaten dan, tot er een user*       (12) interrupt wordt gegeven.*       De updater kan worden gestopt met een hangup (1)*       interrupt.*       Update is bedoeld om in /etc/startup te zetten.*       Er zit dan geen terminal aan verbonden, en hij schrijft*       zijn status naar /etc/.update.status  .************************************************************************        org     0        lib     sysdef          system call definities        lib     sysints         system interrupt definities***      ===Constanten en definities===*updtim  equ     30              tijd tussen updaten***      ===Programma===*start   equ     *        jsr     crfile          create status file        sys     write,actmsg,actlen     schrijf active status        jsr     clsfil          close statusfile        sys     fork            splits in tweeen        bra     goupd           geforkte taak gaat updaten        lbra    einde           oorspronkelijke taak gaat dood*goupd   jsr     setvec          catch alle interrupts        sys     cpint,TERMI,susp        interrupt voor suspenden        sys     update          update het filesystem        ldd     #updtim         tijd tussen het updaten        sys     alarm           geef interrupt na een tijdje        sys     stop            wacht op interrupt        bra     goupd           ga naar volgende update cyclus*susp    jsr     setvec          catch alle interrupts        sys     cpint,USERI,resume      interrupt voor verdergaan        jsr     crfile          create status file        sys     write,susmsg,suslen     schrijf suspended status        jsr     clsfil          close status filewacht   sys     stop            wacht op interrupt        lda     goback          haal vlag op        bne     rtrn            bij resume interrupt terug        sys     cpint,USERI,resume      interrupt voor verdergaan        bra     wacht           wacht weer verderrtrn    rti                     terug naar update gedeelte*resume  jsr     setvec          catch alle interrupts        jsr     crfile          create status file        sys     write,actmsg,actlen     schrijf active status        jsr     clsfil          close status file        lda     #1              zet vlag voor terug naar update        sta     goback          en bewaar hem        rti                     terug naar susp gedeelte*gostop  jsr     crfile          create status file        sys     write,stpmsg,stplen     schrijf stopped status        jsr     clsfil          close status file        sys     update          update file system        bra     einde           ga stoppen*setvec  sys     cpint,HANGI,gostop      hangup int * STOP        sys     cpint,INTI,catch        keyboard int        sys     cpint,QUITI,catch       quit int        sys     cpint,EMTI,catch        emt int        sys     cpint,WPIPI,catch       broken pipe int        sys     cpint,BARGI,catch       bad arg int        sys     cpint,TRACI,catch       trace int        sys     cpint,TIMEI,catch       time limit int        sys     cpint,ALRMI,catch       alarm int        sys     cpint,TERMI,catch       termination int * SUSPEND        sys     cpint,USERI,catch       user int * RESUME        rts                             einde subroutine*catch   jsr     setvec          catch alle interrupts        lda     #0              zet vlag voor verder wachten        sta     goback          en bewaar hem        rti                     keer terug*crfile  sys     create,file,1   create status file        bes     fout            bij fout stoppen        std     statfd          bewaar file descr voor status file        rts                     en keer terug*clsfil  ldd     statfd          haal file descr voor status file        sys     close           close status file        rts                     en keer terug*fout    ldd     #2              schrijf naar std error output        sys     write,ftmeld,ftlen      geef foutmelding*einde   ldd     #0              geen error status        sys     term            einde utility: stop***      ===Teksten===*ftmeld  fcc     'update: /etc/.update.status niet schrijfbaar.',$dftlen   equ     *-ftmeld        lengtesusmsg  fcc     'update: suspended.',$dsuslen  equ     *-susmsg        lengteactmsg  fcc     'update: active.',$dactlen  equ     *-actmsgstpmsg  fcc     'update: stopped.',$dstplen  equ     *-stpmsgfile    fcc     '/etc/.update.status',0 status file***      ===Indirecte system calls===****      ===Variabelen===*statfd  rmb     2               file descriptor voor status filegoback  rmb     1               vlag voor terugkeren*        end     start******************************   EINDE   ****************************************************************************************************