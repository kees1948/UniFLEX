#include <stdio.h>#include <net.h>#include <sgtty.h>#include <getopt.h>#include <signal.h>char buffer[512];struct sgttyb serport;int usage();int sigpip();int mypid = -1;int main(argc, argv)int argc;char **argv;{    int sfdn, i=0, rcount =0, wcount = 0, c;    struct sockaddr_in server;    char *i_opt = NULL;    char *p_opt = NULL;    while((c = getopt (argc,argv, ":i:p:?")) != -1)    {        switch (c)        {            case 'i':                        i_opt = optarg;                        break;            case 'p':                        p_opt = optarg;                        break;            default:                        usage();        }    }    /* check that ALL arguments are resolved!! */    if((i_opt == NULL) || (p_opt == NULL))    {        usage();    }    mypid = getpid();    signal (SIGPIPE, sigpip);    sfdn = socket(AF_INET, SOCK_STREAM|SOCK_NONBLOCK|SOCK_SIGPIPECLS, 0);    bzero(&server, sizeof(struct server));    server.sin_family = AF_INET;    server.sin_port = atoi(p_opt);    server.sin_addr = (uint32_t) inet_addr(i_opt) ;    i = connect(sfdn,(struct sockaddrin*) &server, sizeof(server));    if (i == -1)    {        printf ("Connect error!\n");        exit(1);    }/*    nice(15);        */    while(1)        {            rcount = read (sfdn, buffer, 512);            if (rcount >0 )            {                write (1, buffer, rcount);            }            else if (rcount < 0)            {                exit(0);            }            else            {                gtty(0, &serport);                if(serport.sg_speed & IPDRDY)                    {                        if((wcount = read (0, buffer, 512)) > 0)                        {                            write(sfdn, buffer, wcount);                        }                    }             }         }}int usage(){        fprintf(stderr, "usage: clnta -i server-IP -p server-Port\n");        exit(1);}int sigpip(){        kill (mypid, SIGTERM);        exit(0);}