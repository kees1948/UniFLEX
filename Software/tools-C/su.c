#include <stdio.h>#include <pwd.h>struct  passwd *pwd,*getpwnam();char    *crpass();char    *getpass();char    **environ;main(argc,argv)int     argc;char    **argv;{        char *alist[10];        register char **p;        char *nptr;        char *password,  testpwd[16];        int badsw = 0;        char *shell = "/bin/shell";        if(argc == 1)                nptr = "system";        if(argc == 2)                nptr = argv[1];        if(argc > 2)                {                argv[1]="shell";                alist=argv+1;                execvp(shell, argv+1 );                printf("** Can't execute %s\n",argv[1] );                exit(3);                }        if((pwd=getpwnam(nptr)) == NULL) {                printf("Unknown id: %s\n",nptr);                exit(1);        }        if(pwd->pw_passwd[0] == '\0' || getuid() == 0)                goto ok;        password = getpass("Password:");        if(badsw || (strncmp(crpass(password, testpwd, "ka"),pwd->pw_passwd,16) != 0)) {                printf("Sorry\n");                exit(2);        }ok:        endpwent();        setuid(pwd->pw_uid);        if (pwd->pw_shell && *pwd->pw_shell)        {                chdir(pwd->pw_dir);                spatie_nul(pwd->pw_shell, alist);                execvp(pwd->pw_shell, alist);        }        else                execl(shell, "su", 0);        printf("No shell\n");        exit(3);}spatie_nul(s, lst)      /* omzetten string met spaties naar arglst */char *s;char **lst;{        int     i;        i=1;        lst[0] = s;                     /* 1e lst = 1e woord */        while (*s != 0) {               /* totaan einde regel */                if (*s == ' ') {        /* spatie wordt 0 */                        *s = 0;         /* einde woord */                        s++;            /* naar volgende woord */                        lst[i] = s;     /* woord erbij in lijst */                        lst[i+1] = 0;   /* einde lijst */                        i++;                } else                        s++;        }}