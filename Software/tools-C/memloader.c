#include <stdio.h>#include <fcntl.h>#include <modes.h>/*  usage:   s1 <your_s1_file> |memloader  <select> *  when the addressed target has a MONitor program that *  supports the 'DPRD' device, the hexfile is loaded into *  memory of the target. NO checking is done on the  *  memory range in the 's1' file! *   *  after finish loading, the 'dbgio <select> gives you *  access to the MONitor program on the target. *  This allows you to run, dump, etc contents on the target */char *devicename = "/dev/smem";/* commandline argument  0        1        2        3        4        5   *//*                    IOP0     IOP1      FLP               NET     RDSK   */long dbgoffset[] = {0x0f2fcL,0x0f3fcL,0x0e3fcL,0x0e7fcL,0x0ebfcL,0x0effcL};int main(argc, argv)int argc;char **argv;{        int fdn = -1;        unsigned char c, t;        int d, i;        if (argc != 2)        {                fprintf(stderr, "usage: memloader x\n");                fprintf(stderr, "where 'x' is a digit from 0 to 5\n");                return -2;        }        i = atoi( argv[1]);        if (!( (i >= 0) && (i <= sizeof(dbgoffset) / 4) ) )        {            fprintf(stderr,"memloader: argument of of range!\n");            return -3;        }        if((fdn = open(devicename, O_RDWR)) < 0)        {            fprintf(stderr,"Can't open kernel mem!\n");            return -1;        }        /* data from stdin pipe */        while ((d = fgetc(stdin)) != EOF)        {            c = '\0';        /* eat all data coming from IOP and clear  */            do {                lseek(fdn, (long)dbgoffset[i], 0);                read(fdn, &t, 1);                if ( t != 0 ){                    lseek(fdn, (long)dbgoffset[i], 0);                    write(fdn, &c, 1);                }            }            while (t != 0) ;            do {                lseek(fdn, (long)(dbgoffset[i] + 1L) , 0);                read(fdn, &t, 1);            } while (t != 0);            /* previous character has been processed */            lseek(fdn, (long)(dbgoffset[i] + 1L) , 0);            c = (unsigned char) d;            write(fdn, &c, 1);            printf(".");        }        return 0;}