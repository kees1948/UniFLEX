/*  * exonly.c * exonly opens the shell program * given as the first argument onto * standard input and executes the shell. * * exonly must be SUID to the owner * of the shell program or root. * * usage: exonly shell-program [arg1 arg2 arg3 ...] */#asm	info exonly program V 1.00	info by C.A.De Jong	info	info Syntax: exonly shell-script [ arg1...argn ]#endasm#include <stdio.h>main (argc, argv)int argc;char *argv[];{/* * check number of arguments. if < 2, no file * was specified so generate error */	if (argc < 2) {		fprintf(stderr,"exonly: needs file\n");		exit();	}/* check accessibility of shell program by real uid */	if (access (argv[1],1) == -1) {		fprintf(stderr,"exonly: cannot execute %s\n",argv[1]);		exit(2);	}/* * close standard input and reopen with first argument. * generate error message if file can't be opened. */	close(0);	if (open(argv[1], 0) < 0) {		fprintf(stderr,"exonly: cannot open %s\n",argv[1]);		exit(3);	}/** turn off setuid capability now that file is open */	setuid(getuid());/* * set up argument list to /bin/shell. */	argv[0] = "/bin/shell";	argv[1] = "+b";/* * exec /bin/shell with b option. pass any arguments * along in the argv list. print error message * if we can't exec /bin/shell. */	execv("/bin/shell",argv);	fprintf(stderr,"exonly: cannot exec /bin/shell\n");	exit(4);}