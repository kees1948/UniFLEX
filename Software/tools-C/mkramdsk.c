/*  mkramdsk, create one or two ram disks    total size can never exceed the real size    ram disk max size CPU09RAM is 4 MB*/#include <stdio.h>#include <fcntl.h>#include <sgtty.h>#include <modes.h>#define RAM0 "/dev/ram0"#define RAM1 "/dev/ram1"#define RAMC0 "/dev/ramc0"#define RAMC1 "/dev/ramc1"#define MBYTE1 1024  /* one less, 1 relative *//* SW2 */#define DONTTOUCH 0x80 /* don't rebuild filesystem */#define WRITEPROT 0x40 /* write protect, the highest disk *//* SW1 */#define TRY2DISKS 0x08 /* if size allows, make 2 disks */void mkdisk0(dsize);void mkdisk1(dsize);struct raminfo {unsigned int ramofs;unsigned int ramsiz;unsigned char nchips;   /* number of ram devices */unsigned char switch;};unsigned int ramdsiz = 0;char disks2 = 0;   /* indicator for one or 2 disks */char swtinf = 0;   /* copy of switches */struct raminfo myram;char cmdbuf[64];main(argc, argv)int     argc;char ** argv;{    int ramfdn0, ramfdn1;    pflinit();    if((ramfdn0 = open (RAMC0, O_RDWR)) < 0)    {        fprintf(stderr, "*** Can't open ram device\n");        exit(1);    }    gtty (ramfdn0, &myram);    swtinf = myram.switch;    ramdsiz = myram.nchips * 512;    if (ramdsiz  > MBYTE1)        disks2 = 1;    if (ramdsiz == 0)    {        fprintf(stderr, "*** No RAM disk size found\n");        exit (1);    }    if (!(swtinf & DONTTOUCH))        exit(0);                /* leave as is */    if ((swtinf & TRY2DISKS) && disks2)    {        if((ramfdn1 = open (RAMC1, O_RDWR)) < 0)        {            fprintf(stderr, "*** Can't open ram device\n");            exit(1);        }        myram.ramofs = 0;        myram.ramsiz = MBYTE1 * 2; /* 1 KByte is 2 blocks */        stty(ramfdn0, &myram);        myram.ramofs = myram.ramsiz;  /* previous size is now offset */        myram.ramsiz = (ramdsiz - MBYTE1) * 2;  /* 1 KByte is 2 blocks */        stty(ramfdn1, &myram);        mkdisk0(MBYTE1);        mkdisk1(ramdsiz - MBYTE1);    }    else    {        myram.ramofs = 0;        myram.ramsiz = ramdsiz * 2; /* 1 KByte is 2 blocks */        stty(ramfdn0, &myram);        mkdisk0(ramdsiz);        mkdisk1(0);    }}void mkdisk0(dsize0)unsigned int dsize0;{    sprintf(cmdbuf,"/etc/mkfsu +d%s +qn +s%d > /dev/null", RAM0, (dsize0 * 2)-1);    system(cmdbuf);}void mkdisk1(dsize1)unsigned int dsize1;{    sprintf(cmdbuf, "/etc/mkfsu +d%s +qn +s%d > /dev/null", RAM1, (dsize1 * 2)-1);    system(cmdbuf);}