UniFLEX Monitor ROM                  11:38:13  Jan 24, 2021   Page    1Equates                                                                                       *                     * generic defines for unibug ROM                     *                               opt    lis                       0000                         abs                                          *                     * Monitor ROM for booting UniFLEX and handling the UniFLEX                     * interrupt processing.                     * 2020-12-19  added init  step voor kernel debgger 0.08                     *                                          * low ram interrupt vectors                       0000                         org    sysseg<<12                       0000               irqvec    rmb    2         maskable interrupt  0002               swivec    rmb    2         swi 1  0004               sw2vec    rmb    2         swi 2  0006               sw3vec    rmb    2         swi 3  0008               nmivec    rmb    2         non-maskable interrupt  000A               frqvec    rmb    2         fast interrupt                                          * low memory system storage                       000C               cputyp    rmb    1         cpu type  000D               cpumod    rmb    1         cpu mode 63/68  000E               usrtop    rmb    1         current user segment  000F               kernel    rmb    1         kernel/user state (-1 = user address space)  0010               chpflg    rmb    1         change process flag  0011               chtask    rmb    2         change process vector  0013               corcnt    rmb    1         core segment count  0014               lstmem    rmb    2         mem table end marker  0016               teluch    rmb    1         user change flag  0017               memmsk    rmb    1         dat cell mask  0018               romspr    rmb    1         spare byte for rom                                          * System and global memory maps  0100                         org    (sysseg<<12)+$100                       0100               sysmap    rmb    segadr    system memory map  0110               cormap    rmb    segmax    available memory list                                          * User block definitions                       BF38                         org    (usrseg<<12)+$f38                                    BF00  ubasea    set    (usrseg<<12)+$f00               00BF  ubasdp    set    ubasea/256                     *UniFLEX Monitor ROM                  11:38:13  Jan 24, 2021   Page    2Equates                                                            BF38  sysstk    equ    *         system stack starts here  BF38               udummy    rmb    3         spare  BF3B               ustksz    rmb    1         save interrupt stack depth  BF3C               uargp     rmb    2         user argv pointer  BF3E               uswi2v    rmb    2         swi2 vector save                     * this _should_ be at ff40.  BF40               usp       rmb    2         user stack pointer  BF42               urelod    rmb    1         map reload flag  BF43               umapno    rmb    1         task map number  BF44               usrmap    rmb    segadr    user task memory map                     *  BF54               usercc    rmb    1         condition codes  BF55               userd     rmb    2         D register  BF57               userx     rmb    2         X register  BF59               userpc    rmb    2         PC register  BF5B               userpb    rmb    1         sys call post byte                                          UniFLEX Monitor ROM                  11:38:13  Jan 24, 2021   Page    3Initial ROM Processing                                                                        *                     * Rom code starts here                     *                       F800                         org    romadr                     *                     * I/O Vectors                     *  F800 F80E                    fdb    rinit     cold start monitor  F802 FC07                    fdb    tinit     console init  F804 FB9D                    fdb    inchck    test console character ready  F806 FBA5                    fdb    inch      read one character fromconsoleterminal  F808 FBBC                    fdb    outch     write one character to console  F80A FB70                    fdb    pdata     print a string (X)  F80C FB87                    fdb    hexbyt    print one hex byte (A)                                          *                     * bring monitor to life                     *  F80E               rinit     seti  F810 10CE BE80               lds    #romstk   set stack                     *  F814 4F                      clra             set dp  F815 1F   8B                 tfr    a,dp                     *  F817 8E   F400               ldx    #datbox   fill datbox with blackholes  F81A 108E 0400               ldy    #datsiz  F81E 86   FD                 lda    #nomap    black hole  F820 8C   F40F     rinit9    cmpx   #datbox+romseg don't vanish myself  F823 27   02                 beq    rinit8  F825 A7   84                 sta    0,x  F827 30   01       rinit8    leax   1,x  F829 31   3F                 leay   -1,y  F82B 26   F3                 bne    rinit9                     *  F82D CC   0100               ldd    #rammap  F830 B7   F40B               sta    datbox+usrseg setup user and system segments  F833 F7   F400               stb    datbox+sysseg  F836 86   FD                 lda    #nomap    fill system map with blackholes  F838 C6   10                 ldb    #segadr   get length of map  F83A 8E   0110               ldx    #sysmap+segadr point to map  F83D A7   82       rinit2    sta    0,-x      stuff into map cell  F83F 5A                      decb             dec the count  F840 26   FB                 bne    rinit2                     *  F842 CC   FEFF               ldd    #rommap   complete the initial map  F845 ED   0E                 std    ioseg,x   set io and rom  F847 FD   F40E               std    datbox+ioseg  F84A CC   0100               ldd    #rammap  F84D A7   0B                 sta    usrseg,x  set user segment  F84F 97   0E                 sta    usrtopUniFLEX Monitor ROM                  11:38:14  Jan 24, 2021   Page    4Initial ROM Processing                                F851 E7   84                 stb    sysseg,x  set system segment  F853 4F                      clra             init the direct page registers  F854 97   0C                 sta    cputyp    clear cpu type  F856 97   0D                 sta    cpumod  F858 97   10                 sta    chpflg    clear change task flag  F85A 97   13                 sta    corcnt    zero core count  F85C B7   BF42               sta    urelod  F85F B7   BF43               sta    umapno  F862 97   17                 sta    memmsk  F864 97   16                 sta    teluch                     * all memory set  F866 B7   FE03               sta    tlatch    initializes latch to 0                     * init debugger hardware (if present)  F869 BE   E800               ldx    dbsign    check if kernel debug present  F86C 8C   A55A               cmpx   #DEBSIG   special pattern  F86F 26   04                 bne    rinod     no, just return  F871 AD   9F E804            jsr    [debini]  init debugger                     * set trap PIA and LED and TIMER  F875 86   04       rinod     lda    #$04      select data register  F877 B7   F005               sta    monpcra  F87A B7   F007               sta    monpcrb  F87D 4F                      clra             all output  F87E B7   F006               sta    monpdrb   LEDS off  F881 B7   F004               sta    monpdra   timer stop  F884 B7   F005               sta    monpcra   dir register  F887 B7   F007               sta    monpcrb  F88A 86   0F                 lda    #$0f      select timer/rom control  F88C B7   F004               sta    monpdra  F88F 86   FF                 lda    #$ff  F891 B7   F006               sta    monpdrb  F894 86   04                 lda    #$04      select data register  F896 B7   F005               sta    monpcra  F899 B7   F007               sta    monpcrb   disabled mem trap irq                     *  F89C BD   FC07               jsr    tinit     init the terminal  F89F 8E   FC1D               ldx    #hello    point to string  F8A2 BD   FB70               jsr    pdata     print the string  F8A5 108E 0000               ldy    #irqvec   point to int vectors  F8A9 8E   FB1E               ldx    #unhand   and unhandeled routine  F8AC C6   06                 ldb    #6        set count  F8AE AF   A1       rinit4    stx    0,y++     store vector  F8B0 30   07                 leax   7,x       point to next panic  F8B2 5A                      decb  F8B3 26   F9                 bne    rinit4  F8B5 9F   11                 stx    chtask    set change task vector                     UniFLEX Monitor ROM                  11:38:14  Jan 24, 2021   Page    5Main Monitor Loop                                                                             *                     * Main monitor loop (command processor)                     *                                          * Loop starts here                       F8B7               montor  F8B7 10CE BE80               lds    #romstk  F8BB 33   E4                 leau   0,s       mark stack  F8BD 32   E8 E4              leas   -dlen,s   make temp space  F8C0 8E   FC49     nxtcmd    ldx    #prompt   point to prompt string  F8C3 BD   FB70               jsr    pdata     output it  F8C6 BD   FBA5               jsr    inch      get response  F8C9 BD   FB7B               jsr    outsp     output space  F8CC 8E   F8E1               ldx    #commnd   point to command table  F8CF 8D   05                 bsr    search    search for command  F8D1 AD   98 01              jsr    [1,x]     execute command  F8D4 20   E1                 bra    montor    repeat                                          * Search command table for command                       F8D6 A1   84       search    cmpa   0,x       is it this guy?  F8D8 27   06                 beq    searc2  F8DA 30   03                 leax   3,x       skip this one  F8DC 6D   84                 tst    0,x       end of list?  F8DE 26   F6                 bne    search  F8E0 39            searc2    rts              return                                          * Command table                       F8E1 0D            commnd    fcb    $d        carriage return  F8E2 F962                    fdb    dummy  F8E4 43                      fcb    'C        Configure command  F8E5 F8F9                    fdb    figlef  F8E7 44                      fcb    'D        Disk boot  F8E8 F925                    fdb    dboot  F8EA 45                      fcb    'E        Examine  F8EB F963                    fdb    examine  F8ED 4D                      fcb    'M  F8EE FC5A                    fdb    modify  F8F0 56                      fcb    'V        Mapper  F8F1 F9E2                    fdb    mapper  F8F3 4A                      fcb    'J  F8F4 FCB9                    fdb    jumpprg  F8F6 00                      fcb    0         end of table  F8F7 F95C                    fdb    badcmd                                          * Configure the system command                       F8F9 BD   FA5F     figlef    jsr    config    do configuration  F8FC 96   13                 lda    corcnt    get core countUniFLEX Monitor ROM                  11:38:14  Jan 24, 2021   Page    6Main Monitor Loop                                     F8FE 8B   07                 adda   #7        add in system core count  F900 A7   5A                 sta    count,u   save it  F902 CC   0000               ldd    #0        set count to 0  F905 8B   04       figle2    adda   #4        covert to decimal  F907 19                      daa  F908 C9   00                 adcb   #0        add in carry  F90A 6A   5A                 dec    count,u  F90C 26   F7                 bne    figle2    finished?  F90E 5D                      tstb             more than 99K of memory?  F90F 27   09                 beq    figle4  F911 1E   89                 exg    a,b       do upper digit now  F913 8B   30                 adda   #$30  F915 BD   FBBC               jsr    outch     output it  F918 1E   98                 exg    b,a       get low back  F91A BD   FB87     figle4    jsr    hexbyt    output byte  F91D BD   FB7B               jsr    outsp     output space  F920 86   4B                 lda    #'K       output 'K'  F922 7E   FBBC     figle5    jmp    outch                                          * Disk boot command                       F925 BD   FA5F     dboot     jsr    config    configure system                     *  F928 5F                      clrb  F929 CE   F100               ldu    #brdbas0  F92C 108E 4E20               ldy    #20000  F930 BD   FB9D     dboot1    jsr    inchck    key pressed  F933 25   09                 bcs    dboot2  F935 17   0121               lbsr   delay  F938 31   3F                 leay   -1,y  F93A 26   F4                 bne    dboot1  F93C 20   0F                 bra    dboot3                     *  F93E BD   FBA5     dboot2    jsr    inch      get character from keyboard  F941 81   0D                 cmpa   #$0d      ENTER?  F943 27   08                 beq    dboot3  F945 81   31                 cmpa   #'1  F947 22   04                 bhi    dboot3    invalid  F949 80   30                 suba   #'0  F94B 1F   89                 tfr    a,b                     *  F94D BD   F9EB     dboot3    jsr    loadip    load the ipl sector  F950 27   04                 beq    dboot4  F952 BD   FB87               jsr    hexbyt  F955 39                      rts                     *  F956 10CE BF38     dboot4    lds    #sysstk   setup UniFLEX stack  F95A 6E   84                 jmp    0,x       go do the boot                                          * Bad command                       F95C 8E   FC4C     badcmd    ldx    #sorry    point to stringUniFLEX Monitor ROM                  11:38:15  Jan 24, 2021   Page    7Main Monitor Loop                                     F95F BD   FB70               jsr    pdata     output it  F962 39            dummy     rts              return                     UniFLEX Monitor ROM                  11:38:15  Jan 24, 2021   Page    8Memory Examine Command                                                   *                     * Examine memory (system)                     *  F963               examine  F963 BD   FBCB               jsr    getadr    get low address  F966 25   16                 bcs    exam99  F968 ED   5C                 std    lowadr,u  save low limit  F96A 86   2D                 lda    #'-  F96C BD   FBBC               jsr    outch  F96F BD   FBCB               jsr    getadr    get high address  F972 25   0A                 bcs    exam99  F974 ED   5E                 std    hiadr,u   save high limit  F976 AE   5C                 ldx    lowadr,u  set up for dump  F978 10AE 5E                 ldy    hiadr,u >F97B BD   F97F               jsr    dumpXY    go print dump  F97E 39            exam99    rts                     *                     * dumpXY - Dump memory from (X) to (Y)                     *    (X) - Lowest address to dump                     *    (Y) - Highest address to dump                     *    jsr dumpXY                     *  F97F 34   70       dumpXY    pshs   x,y,u     save registers                     *                     * Print one line (16 bytes) of data                     * >F981 BD   F9D6     dump10    jsr    pcrlf     start a new print line  F984 A6   E4                 lda    0,s       print address  F986 BD   FB87               jsr    hexbyt  F989 A6   61                 lda    1,s  F98B BD   FB87               jsr    hexbyt  F98E BD   FB7B               jsr    outsp  F991 BD   FB7B               jsr    outsp  F994 AE   E4                 ldx    0,s  F996 C6   10                 ldb    #16       print 16 bytes  F998 34   04                 pshs   b  F99A A6   80       dump20    lda    ,x+       get next byte to print  F99C BD   FB87               jsr    hexbyt  F99F BD   FB7B               jsr    outsp  F9A2 6A   E4                 dec    0,s       done?  F9A4 26   F4                 bne    dump20    no - go back  F9A6 AE   61                 ldx    1,s       now print characters  F9A8 BD   FB7B               jsr    outsp  F9AB BD   FB7B               jsr    outsp  F9AE C6   10                 ldb    #16  F9B0 E7   E4                 stb    0,s  F9B2 A6   80       dump30    lda    ,x+       get next byte  F9B4 81   20                 cmpa   #$20      printable?  F9B6 25   04                 blo    dump35    no  F9B8 81   7F                 cmpa   #$7F  F9BA 25   02                 blo    dump40    go print character  F9BC 86   2E       dump35    lda    #'.       print period for unprintableUniFLEX Monitor ROM                  11:38:15  Jan 24, 2021   Page    9Memory Examine Command                                F9BE BD   FBBC     dump40    jsr    outch     print character  F9C1 6A   E4                 dec    0,s       done?  F9C3 26   ED                 bne    dump30  F9C5 32   61                 leas   1,s       clean up stack  F9C7 BD   FB9D               jsr    inchck    abort if character struck  F9CA 25   06                 bcs    dump99  F9CC AF   E4                 stx    0,s       update address  F9CE AC   62                 cmpx   2,s       any more?  F9D0 23   AF                 bls    dump10    yes - go to it  F9D2 8D   02       dump99    bsr    pcrlf  F9D4 35   F0                 puls   x,y,u,pc  return                     *                     * pcrlf - print carriage return/line feed                     *  F9D6 34   16       pcrlf     pshs   d,x       save registers  F9D8 8E   F9E0               ldx    #CRLF  F9DB BD   FB70               jsr    pdata  F9DE 35   96                 puls   d,x,pc    return  F9E0 0D 00         CRLF      fcc    $d,0                                          *                     * Map memory into buffer ($d000)                     *  F9E2 BD   FBD7     mapper    jsr    getbyt    get byte  F9E5 25   03                 bcs    mappe8  F9E7 B7   F40D               sta    datbox+$d  F9EA 39            mappe8    rts              return                                          *                     *   IDE Bootstrap                     *   reset the stack and set up direct addressing                     *   U contains controller base address                     *   B contains drive select bits                     *  F9EB               loadip    seti   irq,firq  disable irq and firq  F9ED 34   04                 pshs   b         save dest drive  F9EF C4   01                 andb   #%00000001  F9F1 34   04                 pshs   b         save drive bits  F9F3 27   04                 beq    loadi1  F9F5 86   10                 lda    #IDE_DSL  drive select bit  F9F7 A7   E4                 sta    0,s  F9F9               loadi1                     *                     *   quiesce the dma (in case it is active)                     *  F9F9 6F   C8 13              clr    dmaltc,u  disable everything                     *  F9FC CC   0040               ldd    #IDE_LBA  F9FF EA   E4                 orb    0,s       drive select bit  FA01 ED   4C                 std    ideadr3,u LBA 24...27, drive 0                     *  FA03 EC   4E                 ldd    idecmst,u read statusUniFLEX Monitor ROM                  11:38:15  Jan 24, 2021   Page   10IDE Bootstrap                                         FA05 C1   50                 cmpb   #(IDERDY+IDEDSC) idle  FA07 26   42                 bne    loadxit   drive not ready                     *  FA09 CC   0010               ldd    #IDERSTR  FA0C ED   4E                 std    idecmst,u restore drive >FA0E 17   0048     waitrst   lbsr   delay                     *            ldd        idecmst,u                     *            bitb       #IDEBSY            drive busy?                     *            beq        waitrst                     * >FA11 17   0045     isnrdy    lbsr   delay  FA14 EC   4E                 ldd    idecmst,u check if done  FA16 C5   80                 bitb   #IDEBSY  FA18 26   F7                 bne    isnrdy                     *  FA1A CC   0001               ldd    #1  FA1D ED   44                 std    idescnt,u sector count  FA1F 5F                      clrb             LBA 0  FA20 ED   46                 std    ideadr0,u first sector LBA 0...7  FA22 ED   48                 std    ideadr1,u LBA 8...15  FA24 ED   4A                 std    ideadr2,u LBA 16...23  FA26 CC   0040               ldd    #IDE_LBA  FA29 EA   E4                 orb    0,s       drive select bit  FA2B ED   4C                 std    ideadr3,u LBA 24...27, drive 0  FA2D CC   0800               ldd    #bootorg  load real boot address  FA30 ED   C8 10              std    dmaadh,u  FA33 86   C0                 lda    #L_DREAD+L_DMAEN  FA35 A7   C8 13              sta    dmaltc,u  set high addr  FA38 C6   C8                 ldb    #IDEDRD  FA3A ED   4E                 std    idecmst,u  FA3C A6   C8 18    ider1     lda    idestat,u  FA3F 85   80                 bita   #IDEINTR  FA41 27   F9                 beq    ider1     wait for done  FA43 EC   4E                 ldd    idecmst,u read status  FA45 C5   01                 bitb   #IDEERR  FA47 27   0A                 beq    doboot  FA49 1F   98                 tfr    b,a                     * faillure  FA4B E7   61       loadxit   stb    1,s       save status  FA4D 86   FF                 lda    #$ff      set bad  FA4F A7   E4                 sta    0,s  FA51 35   86                 puls   d,pc                     *  FA53 8E   0800     doboot    ldx    #bootorg  where boot is loaded  FA56 4F                      clra             set status  FA57 35   86                 puls   d,pc      D has drive select info                     *  FA59 86   40       delay     lda    #64       set up a delay counter  FA5B 4A            del       deca             decrement the delay count  FA5C 26   FD                 bne    del       hang in there for the count  FA5E 39                      rts                     UniFLEX Monitor ROM                  11:38:16  Jan 24, 2021   Page   11IDE Bootstrap                                       UniFLEX Monitor ROM                  11:38:16  Jan 24, 2021   Page   12System Configuration                                                     *                     * Configure the system                     *                                          * code starts here  FA5F 8E   99AA     config    ldx    #tstpat   setup pattern  FA62 108E 0210               ldy    #cormap+segmax setup page table pointer  FA66 C6   F7                 ldb    #LSTPAG   setup max page number                     * >FA68 BD   FAE2     check     jsr    getpag    map in a page  FA6B BF   D0F0               stx    tstloc    write test pattern  FA6E BC   D0F0               cmpx   tstloc    is memory there?  FA71 26   16                 bne    nomem  FA73 34   04                 pshs   b         save count >FA75 BD   FAE2     check2    jsr    getpag    map in all other pages  FA78 F7   D0F1               stb    tstloc+1  write index  FA7B C0   01                 subb   #1        dec count by 1  FA7D 24   F6                 bcc    check2  FA7F 35   04                 puls   b >FA81 BD   FAE2               jsr    getpag    reselect the page  FA84 F1   D0F1               cmpb   tstloc+1  is memory there?  FA87 27   01                 beq    gotmem                     * here if no memory  FA89 4F            nomem     clra             set page number to zero                     * here for memory found  FA8A A7   A2       gotmem    sta    0,-y      store into mem table  FA8C C0   01                 subb   #1        dec the count  FA8E 24   D8                 bcc    check                     *  FA90 30   A4                 leax   0,y       point to start of table                                          * setup system address space  FA92 6F   84       syssup    clr    sysres,x  clear out system and user pages  FA94 6F   01                 clr    useres,x  FA96 108E 0105               ldy    #sysmap+txtseg point to user segment  FA9A C6   05                 ldb    #5        set length ** changed from 5 for more  FA9C 8D   4A       syssu2    bsr    getnxt    get next segment >FA9E 1027 0050               lbeq   memfal    crash if no memory!  FAA2 A7   A0                 sta    0,y+      save in map  FAA4 5A                      decb             dec the count  FAA5 26   F5                 bne    syssu2  FAA7 0F   13                 clr    corcnt    set core count to zero  FAA9 108E 0110               ldy    #cormap   point to core map  FAAD 8D   39       syssu4    bsr    getnxt    get next page  FAAF 27   06                 beq    syssu5    no more?  FAB1 A7   A0                 sta    0,y+      save in table  FAB3 0C   13                 inc    corcnt    bump core counter  FAB5 20   F6                 bra    syssu4    repeat  FAB7 109F 14       syssu5    sty    lstmem    save last mem pointer  FABA 8E   0100               ldx    #sysmap   point to system map  FABD 108E F400               ldy    #datbox   point to datbox  FAC1 C6   10                 ldb    #segadr   get segment countUniFLEX Monitor ROM                  11:38:16  Jan 24, 2021   Page   13System Configuration                                  FAC3 A6   80       syssu6    lda    0,x+      reload datbox from map  FAC5 A7   A0                 sta    0,y+  FAC7 5A                      decb             dec the count  FAC8 26   F9                 bne    syssu6                     * test timer  FACA 4F                      clra             enable timer  FACB B7   F004               sta    monpdra  FACE B6   F004               lda    monpdra   read value  FAD1 34   02                 pshs   a  FAD3 5F                      clrb >FAD4 17   FF82     systm1    lbsr   delay  FAD7 5C                      incb  FAD8 26   FA                 bne    systm1    256 loops  FADA 35   02                 puls   a  FADC B0   F004               suba   monpdra   is it running  FADF 27   27                 beq    notimr  FAE1 39                      rts              return                                          * map in a memory page  FAE2 1F   98       getpag    tfr    b,a       get page number  FAE4 B7   F40D               sta    datbox+tfrseg map into address space  FAE7 39                      rts              return                                          * get next valid memory segment  FAE8 8C   0210     getnxt    cmpx   #cormap+segmax end of map?  FAEB 27   04                 beq    getnx2  FAED A6   80                 lda    0,x+      get next page  FAEF 27   F7                 beq    getnxt    keep looking if zero  FAF1 39            getnx2    rts              return                                          * No memory panic >FAF2 BD   FB56     memfal    jsr    panic     report panic  FAF5 4E 6F 74 20             fcc    'Not Enough Memory!',0 >FB08 BD   FB56     notimr    jsr    panic     report timer  FB0B 54 69 6D 65             fcc    'Timer not Running!',0                     *                     * Terminal I/O and bad interrupt handlers                     *                                          * Report unhandled interrupts, fixed sequence.  FB1E 8D   36       unhand    bsr    panic  FB20 49 52 51 20             fcc    'IRQ ',0  FB25 8D   2F       unswi     bsr    panic  FB27 53 57 49 20             fcc    'SWI ',0  FB2C 8D   28       unswi2    bsr    panic  FB2E 53 57 49 32             fcc    'SWI2',0  FB33 8D   21       unswi3    bsr    panic  FB35 53 57 49 33             fcc    'SWI3',0  FB3A 8D   1A       unnmi     bsr    panic  FB3C 4E 4D 49 20             fcc    'NMI ',0  FB41 8D   13       unfirq    bsr    panic  FB43 46 49 52 51             fcc    'FIRQ',0UniFLEX Monitor ROM                  11:38:16  Jan 24, 2021   Page   14System Configuration                                  FB48 8D   0C                 bsr    panic  FB4A 43 48 50 52             fcc    'CHPR',0                     *  FB4F 8D   05       cputrp    bsr    panic  FB51 54 52 41 50             fcc    'TRAP',0                                          * Panic processing  FB56               panic     seti   mask      ints  FB58 8E   FC4F               ldx    #panicy   point to string  FB5B 8D   13                 bsr    pdata     print it  FB5D 35   10                 puls   x         get message  FB5F 8D   0F                 bsr    pdata     print it  FB61 10CE BE80               lds    #romstk   set rom stack  FB65 7E   F8B7               jmp    montor    init romUniFLEX Monitor ROM                  11:38:16  Jan 24, 2021   Page   15System Configuration                                                                          * String display routine >FB68 BD   FBBC     newlin    jsr    outch     output cr  FB6B 86   0A                 lda    #$a       setup line feed >FB6D BD   FBBC     putch     jsr    outch     output it  FB70 A6   80       pdata     lda    0,x+      get string character  FB72 27   06                 beq    pdata2    end of string?  FB74 81   0D                 cmpa   #$d       is it cr?  FB76 27   F0                 beq    newlin  FB78 20   F3                 bra    putch     go output char  FB7A 39            pdata2    rts              return                                          * Output a space  FB7B 34   02       outsp     pshs   a         save a  FB7D 86   20                 lda    #$20      setup space  FB7F 8D   3B                 bsr    outch     output it  FB81 35   82                 puls   a,pc      return                                          * Output hex word  FB83 8D   02       hexwrd    bsr    hexbyt  FB85 1F   98                 tfr    b,a                                          * Output a hex byte  FB87 34   02       hexbyt    pshs   a         save byte  FB89 44                      lsra             shift right 4 bits  FB8A 44                      lsra  FB8B 44                      lsra  FB8C 44                      lsra  FB8D 8D   02                 bsr    hexdig    output it  FB8F 35   02                 puls   a         restore digit                                          * Output a digit in hex  FB91 84   0F       hexdig    anda   #$0f      mask low bits  FB93 8B   30                 adda   #'0       make ascii digit  FB95 81   39                 cmpa   #'9       is it digit?  FB97 23   23                 bls    outch  FB99 8B   07                 adda   #7        add letter bias  FB9B 20   1F                 bra    outch                                          * Test for an input character  FB9D 34   02       inchck    pshs   a         save a  FB9F B6   F000               lda    acia      get status  FBA2 44                      lsra             check status bit  FBA3 35   82                 puls   a,pc      return                                          * Input a character with echo  FBA5 B6   F000     inch      lda    acia      get status  FBA8 44                      lsra             check bit  FBA9 24   FA                 bcc    inch      wait for character  FBAB B6   F001               lda    acia+1    get character  FBAE 84   7F                 anda   #$7f      mask parity  FBB0 27   F3                 beq    inch      ignore nullsUniFLEX Monitor ROM                  11:38:17  Jan 24, 2021   Page   16System Configuration                                  FBB2 81   61                 cmpa   #'a       is it lower case?  FBB4 25   06                 blo    outch  FBB6 81   7A                 cmpa   #'z  FBB8 22   02                 bhi    outch  FBBA 80   20                 suba   #$20      make upper case                                          * Output character routine  FBBC 34   02       outch     pshs   a         save character  FBBE B6   F000     outchw    lda    acia      get status  FBC1 85   02                 bita   #2        check status  FBC3 27   F9                 beq    outchw  FBC5 35   02                 puls   a         get character  FBC7 B7   F001               sta    acia+1    output it  FBCA 39                      rts              return                                          * Get address  FBCB 8D   0A       getadr    bsr    getbyt    get byte  FBCD A7   E3                 sta    0,--s     save on stack  FBCF 25   04                 bcs    getext  FBD1 8D   04                 bsr    getbyt    get byte  FBD3 A7   61                 sta    1,s  FBD5 35   86       getext    puls   d,pc      return                                          * Get byte  FBD7 32   7F       getbyt    leas   -1,s  FBD9 8D   11                 bsr    gethex    input hex digit  FBDB 25   0C                 bcs    hexit  FBDD 48                      lsla  FBDE 48                      lsla  FBDF 48                      lsla  FBE0 48                      lsla  FBE1 A7   E4                 sta    0,s  FBE3 8D   07                 bsr    gethex    get hex digit  FBE5 25   02                 bcs    hexit  FBE7 AA   E4                 ora    0,s  FBE9 32   61       hexit     leas   1,s       clean stack  FBEB 39                      rts              return                                          * Get hex digit >FBEC BD   FBA5     gethex    jsr    inch      get character  FBEF 81   30                 cmpa   #'0       is it digit?  FBF1 25   11                 blo    nothex  FBF3 81   39                 cmpa   #'9  FBF5 23   0A                 bls    idigit  FBF7 81   41                 cmpa   #'A  FBF9 25   09                 blo    nothex  FBFB 81   46                 cmpa   #'F  FBFD 22   05                 bhi    nothex  FBFF 80   07                 suba   #'A-'0-10  FC01 80   30       idigit    suba   #'0  FC03 39                      rts              return  FC04 1A   01       nothex    sec              set carryUniFLEX Monitor ROM                  11:38:17  Jan 24, 2021   Page   17System Configuration                                  FC06 39                      rts              return                                          * Initialize the terminal  FC07 34   06       tinit     pshs   d         save reg  FC09 86   03                 lda    #$3       reset acia  FC0B B7   F000               sta    acia  FC0E 86   15                 lda    #$15      set up bits & stuff  FC10 B7   F000               sta    acia  FC13 CC   3A98               ldd    #15000    delay some here  FC16 83   0001     tinit2    subd   #1  FC19 26   FB                 bne    tinit2  FC1B 35   86                 puls   d,pc      return                                          * messages  FC1D 0D            hello     fcb    $d  FC1E 55 6E 69 46             fcc    'UniFLEX Boot ROM (CPU09:MMU/IDE/MON:0.08)',$d,0  FC49 0D            prompt    fcb    $d  FC4A 25 00                   fcc    '%',0  FC4C 3F 3F 00      sorry     fcc    '??',0  FC4F 0D            panicy    fcb    $d  FC50 50 61 6E 69             fcc    'Panic -> ',0                     UniFLEX Monitor ROM                  11:38:17  Jan 24, 2021   Page   18Memory Modify Command                                                    *                     * Modify system memory                     *  FC5A               modify  FC5A 17   FF6E               lbsr   getadr    get starting address  FC5D 25   53                 bcs    mod99     exit if error  FC5F ED   5C                 std    lowadr,u  save address                     *  FC61 8E   FCB3     mod10     ldx    #modm00  FC64 BD   FB70               jsr    pdata  FC67 A6   5C                 lda    lowadr,u  print address  FC69 BD   FB87               jsr    hexbyt  FC6C A6   5D                 lda    lowadr+1,u  FC6E BD   FB87               jsr    hexbyt  FC71 BD   FB7B               jsr    outsp  FC74 AE   5C                 ldx    lowadr,u  get byte address  FC76 A6   84                 lda    0,x       get value  FC78 34   02                 pshs   a         save current value  FC7A BD   FB87               jsr    hexbyt    output it  FC7D BD   FB7B               jsr    outsp     print a space  FC80 BD   FBEC               jsr    gethex    get a hex digit  FC83 25   1F                 bcs    mod30     jump if error  FC85 48                      asla  FC86 48                      asla  FC87 48                      asla  FC88 48                      asla  FC89 A7   E4                 sta    0,s       update value  FC8B BD   FBEC               jsr    gethex    get second hex digit  FC8E 25   20                 bcs    mod40     exit if error  FC90 AA   E0                 ora    ,s+       compute total value  FC92 AE   5C       mod20     ldx    lowadr,u  get memory address  FC94 A7   80                 sta    ,x+       update memory  FC96 AF   5C                 stx    lowadr,u  update address  FC98 20   C7                 bra    mod10     continue with next byte  FC9A 35   02       mod50     puls   a  FC9C AE   5C                 ldx    lowadr,u  FC9E 30   1F                 leax   -1,x  FCA0 AF   5C                 stx    lowadr,u  FCA2 20   BD                 bra    mod10                     *  FCA4 81   5E       mod30     cmpa   #'^       is it "go back" char?  FCA6 27   F2                 beq    mod50  FCA8 81   2E                 cmpa   #'.       is it "go on" char?  FCAA 26   04                 bne    mod40     no - exit  FCAC 35   02                 puls   a         restore original value  FCAE 20   E2                 bra    mod20     yes - move to next address                     *  FCB0 32   61       mod40     leas   1,s       clean up stack  FCB2 39            mod99     rts              return                     *  FCB3 0D 20 20 2D   modm00    fcc    $d,'  - ',0                     *UniFLEX Monitor ROM                  11:38:17  Jan 24, 2021   Page   19Memory Modify Command                                                    * J - Jump to user program                     *  FCB9               jumpprg  FCB9 BD   FBCB               jsr    getadr    get routine address  FCBC 25   04                 bcs    jump99    exit if error  FCBE 1F   01                 tfr    d,x       get address  FCC0 AD   84                 jsr    0,x       call routine  FCC2 39            jump99    rts                     UniFLEX Monitor ROM                  11:38:18  Jan 24, 2021   Page   20High-Level Interrupt Handling                                                                 *                     * Interrupt handling code - Highest level                     *                     * Should match with inthand code in specific kernel version                     *  FE10                         org    hirom                                          * Process firq                     * either CC,PC or CC....PC (in 6809 or 6309 stack format)                     *                     *   13 PCL  PCL    PCL                     *   12 PCH  PCH    PCH                     *   11 CC   CC     UL                     *   10      -1,S   UH                     *   9       YL     YL                     *   8       YH     YH                     *   7       XL     XL                     *   6       XH     XH                     *   5       DP     DP                     *   4       F      F                     *   3       E      E                     *   2       B      B                     *   1       A      A                     *   0       CC     CC                     *                     * E,F,I are set in new CC  FE10 32   7F       ufirq     leas   -1,s      make room on stack  FE12 34   38                 pshs   dp,x,y    push all regs like irq  FE14                         pshsw  FE16 34   07                 pshs   cc,d      push all regs like irq  FE18 A6   6B                 lda    11,s      get old cc  FE1A EF   6A                 stu    10,s      store proper u reg  FE1C 8A   80                 ora    #$80      set entire bit in cc  FE1E A7   E4                 sta    0,s  FE20 B6   FE00               lda    stkcnt  FE23 81   03                 cmpa   #3  FE25 23   02                 bls    01f  FE27 32   E6                 leas   a,s       was already stacked  FE29 A6   E4       01        lda    0,s       get cc  FE2B 8E   000A               ldx    #frqvec   point to firq vector  FE2E 1F   8A                 tfr    a,cc      should be safe  FE30 20   43                 bra    process                                          * Process a SWI type interrupt  FE32 8E   0002     uswi      ldx    #swivec   get vector  FE35 20   3E                 bra    process   process the int                                          * Process an TRAP interrupt  FE37 C6   07       utrap     ldb    #FALTI    for now  FE39 20   2D                 bra    uflt                     UniFLEX Monitor ROM                  11:38:18  Jan 24, 2021   Page   21High-Level Interrupt Handling                                            * Process user external  FE3B 1F   AB       unmi      tfr    cc,dp  FE3D 10AE 6C                 ldy    STKSIZ-2,s old PC  FE40 7F   FE02               clr    k_u_map   bring in kernel map                     * now BXXX is ust area  FE43 10FF BF40               sts    usp       save stack  FE47 BF   BF57               stx    userx  FE4A FD   BF55               std    userd  FE4D 10BF BF59               sty    userpc  FE51 10CE BF38               lds    #sysstk   set system stack                     *  FE55 4F                      clra  FE56 1E   8B                 exg    a,dp      get cc  FE58 B7   BF54               sta    usercc  FE5B 8E   0008               ldx    #nmivec   set vector  FE5E C6   07                 ldb    #FALTI    set fault  FE60 85   50                 bita   #$50      ints masked?  FE62 27   21                 beq    prcs2  FE64 C6   09                 ldb    #TIMEI    set timeout  FE66 20   1D                 bra    prcs2                                          * Process fault  FE68 8E   0008     uflt      ldx    #nmivec   set for nmi vector  FE6B 20   08                 bra    process                                          * swi2 processor  FE6D 8E   0004     uswi2     ldx    #sw2vec   set vector  FE70 20   03                 bra    process                                          * Process an IRQ type interrupt  FE72 8E   0000     uirq      ldx    #irqvec   get vector                                          * Process the user interrupt, can't use user stack!  FE75 1F   AB       process   tfr    cc,dp  FE77 7F   FE02               clr    k_u_map   task mapper to kernel  FE7A 10FF BF40               sts    usp       save user stack pointer  FE7E 10CE BF38               lds    #sysstk   set system stack  FE82 4F                      clra             set dp to 0  FE83 1E   8B                 exg    a,dp      old cc                     *  FE85 0F   0F       prcs2     clr    kernel  FE87 1F   8A                 tfr    a,cc      restore cc  FE89 AD   94                 jsr    [0,x]     execute int handler  FE8B 20   25                 bra    uswi32    return in common handler                     *                     * Handle swi3 - system call interrupt                     *  FE8D 1C   FE       uswi3     clc              clear the carry bit  FE8F 1F   AB                 tfr    cc,dp     save cc  FE91                         seti   mask      ints  FE93 7F   FE02               clr    k_u_map   map in kernel  FE96 FD   BF55               std    userd     save d registerUniFLEX Monitor ROM                  11:38:18  Jan 24, 2021   Page   22High-Level Interrupt Handling                         FE99 BF   BF57               stx    userx     save x register  FE9C 10FF BF40               sts    usp       save user stack pointer  FEA0 10CE BF38               lds    #sysstk   set system stack  FEA4 4F                      clra             set dp to 0  FEA5 1E   B8                 exg    dp,a  FEA7 B7   BF54               sta    usercc    save user cc                     *  FEAA 0F   0F                 clr    kernel  FEAC                         clri                     *  FEAE AD   9F 0006            jsr    [sw3vec]  execute handler                     *                     * common return from interrupt handler                     *  FEB2               uswi32    seti   mask      ints  FEB4 96   10                 lda    chpflg    change tasks?  FEB6 27   04                 beq    uswi35  FEB8 AD   9F 0011            jsr    [chtask]  change tasks                     *  FEBC               uswi35    clri   open      interrupt window  FEBE 12                      nop  FEBF                         seti  FEC1 0A   0F                 dec    kernel  FEC3 86   BF                 lda    #ubasdp  FEC5 1F   8B                 tfr    a,dp               00BF            setdp  ubasdp  FEC7 10DE 40                 lds    <usp      reset to user stack  FECA 0D   42                 tst    <urelod   new task?  FECC 26   10                 bne    remap                     *  FECE 96   43       usrrti    lda    <umapno   get current task  FED0 27   0C                 beq    remap     blowup if 0 map number  FED2 B7   FE03               sta    tlatch    set task mapper for return                     *  FED5 86   80       allrti    lda    #%10000000 select user map / vector set  FED7 B7   FE02               sta    k_u_map   set user map                     * release kernel map, but just so that the RTI opcode is read yet  FEDA B7   FE01     krnrti    sta    cuddwn    adjust int count/fuse  FEDD 3B                      rti                                          * Load map registers for new task  FEDE 96   43       remap     lda    <umapno   get task number  FEE0 27   79                 beq    ufail  FEE2 4C                      inca             bias by 1, we start at end.....  FEE3 CE   F400               ldu    #datbox   point to dat ram  FEE6 C6   10                 ldb    #segadr   set segment size (16)  FEE8 3D                      mul              calculate map location  FEE9 33   CB                 leau   d,u       point to it  FEEB 0F   42                 clr    <urelod   clear flag  FEED 109E 52                 ldy    <usrmap+14 load maps  FEF0 9E   50                 ldx    <usrmap+12  FEF2 DC   4E                 ldd    <usrmap+10UniFLEX Monitor ROM                  11:38:18  Jan 24, 2021   Page   23High-Level Interrupt Handling                         FEF4 36   36                 pshu   d,x,y  FEF6 109E 4C                 ldy    <usrmap+8  FEF9 9E   4A                 ldx    <usrmap+6  FEFB DC   48                 ldd    <usrmap+4  FEFD 36   36                 pshu   d,x,y  FEFF 9E   46                 ldx    <usrmap+2  FF01 DC   44                 ldd    <usrmap  FF03 36   16                 pshu   d,x       finish load  FF05 20   C7                 bra    usrrti               0000            setdp  0                                          *                     * kernel irq                     *  FF07 0C   0F       kirq      inc    kernel  FF09 AD   9F 0000            jsr    [irqvec]  process interrupt  FF0D 0A   0F                 dec    kernel  FF0F 20   C9                 bra    krnrti                     *                     * kernel external                     *  FF11 BE   E800     knmi      ldx    dbsign    check if kernel debug present  FF14 8C   A55A               cmpx   #DEBSIG   special pattern  FF17 26   04                 bne    knmix     no, just return  FF19 AD   9F E802            jsr    [debnmi]  enter debugger  FF1D 20   BB       knmix     bra    krnrti                                          *                     * kernel mode firq                     *                     * E,F,I are set in new CC  FF1F 32   7F       kfirq     leas   -1,s      make room on stack  FF21 34   38                 pshs   dp,x,y    push all regs like irq  FF23                         pshsw  FF25 34   07                 pshs   cc,d      push all regs like irq  FF27 A6   6B                 lda    11,s      get old cc  FF29 EF   6A                 stu    10,s      store proper u reg  FF2B 8A   80                 ora    #$80      set entire bit in cc  FF2D A7   E4                 sta    0,s  FF2F B6   FE00               lda    stkcnt  FF32 81   03                 cmpa   #3        was is small stack?  FF34 23   02                 bls    01f  FF36 32   E6                 leas   a,s       all was already stacked                     *  FF38 0C   0F       01        inc    kernel  FF3A AD   9F 000A            jsr    [frqvec]  FF3E 0A   0F                 dec    kernel  FF40 20   98                 bra    krnrti                                          *  FF42 BD   FB56     hfail     jsr    panic     hardware rti failure  FF45 48 61 72 64             fcc    'Hardware RTI failure ',0UniFLEX Monitor ROM                  11:38:19  Jan 24, 2021   Page   24High-Level Interrupt Handling                         FF5B BD   FB56     ufail     jsr    panic     blowup on 0 map number  FF5E 5A 65 72 6F             fcc    'Zero map ',0                                          *                     * System reset                     *  FF68 4F            kreset    clra  FF69 B7   FE01               sta    cuddwn    undo reset fetch                     * only HW level 0 allows for acces DAT  FF6C B7   FE03               sta    tlatch  FF6F B7   FE02               sta    k_u_map   map in kernel  FF72 CC   FEFF               ldd    #rommap  FF75 FD   F40E               std    datbox+ioseg set E...+F...  FF78 BE   E800               ldx    dbsign    check if kernel debug present  FF7B 8C   A55A               cmpx   #DEBSIG   special pattern  FF7E 26   04                 bne    kresetx   no, just return  FF80 AD   9F E804            jsr    [debini]  FF84 7E   F80E     kresetx   jmp    rinit     do sys init                                          *                     * System interrupts (unhandled)                     *  FF87 7E   FB25     kswi      jmp    unswi  FF8A 7E   FB2C     kswi2     jmp    unswi2  FF8D 7E   FB33     kswi3     jmp    unswi3                     *kfirq     jmp     unfirq  FF90 7E   FB3A     kextrn    jmp    unnmi  FF93 7E   FB4F     ktrap     jmp    cputrp                                          *                     * interrupt vector definitions                     *                       FFE0                         org    usrvec                       FFE0 FE37                    fdb    utrap  FFE2 FE8D                    fdb    uswi3  FFE4 FE6D                    fdb    uswi2  FFE6 FE10                    fdb    ufirq  FFE8 FE72                    fdb    uirq  FFEA FE32                    fdb    uswi  FFEC FE3B                    fdb    unmi  FFEE FF68                    fdb    kreset                       FFF0                         org    vector                       FFF0 FF93                    fdb    ktrap  FFF2 FF8D                    fdb    kswi3  FFF4 FF8A                    fdb    kswi2  FFF6 FF1F                    fdb    kfirq  FFF8 FF07                    fdb    kirq  FFFA FF87                    fdb    kswiUniFLEX Monitor ROM                  11:38:19  Jan 24, 2021   Page   25High-Level Interrupt Handling                         FFFC FF11                    fdb    knmi  FFFE FF68                    fdb    kreset                                                    end0 Error(s) detected    14 Excessive BRANCH/JUMP(S) detectedUniFLEX Monitor ROM                  11:38:19  Jan 24, 2021   Page   26High-Level Interrupt Handling                       Symbol Table:Absolute Symbols:BLKHOL   00FD   CRLF     F9E0   DATSENSE 0000   DEBSIG   A55A   DIVZRO   00FF   FALTI    0007   IDEBSY   0080   IDEDMRQ  0040   IDEDRD   00C8   IDEDSC   0010   IDEDWR   00CA   IDEERR   0001   IDEINTR  0080   IDEIO16  0001   IDEIORY  0002   IDEIRQ   0004   IDERDY   0040   IDERSTR  0010   IDE_DSL  0010   IDE_LBA  0040   ILGOPC   00FF   KILLI    0005   LSTPAG   00F7   L_ADDR   000F   L_CSEL   0010   L_DMAEN  0040   L_DREAD  0080   L_INTEN  0020   PATIME   0001   PATIMR   0080   PBLGHT   00FF   PBMTRP   0080   PIRQMSK  0080   STKSIZ   000E   TIMEI    0009   acia     F000   allrti   FED5   ascii    FFE4   badcmd   F95C   bootorg  0800   brdbas0  F100   bufseg   000C   check    FA68   check2   FA75   chpflg   0010   chtask   0011   commnd   F8E1   config   FA5F   corcnt   0013   cormap   0110   count    FFFA   cpumod   000D   cputrp   FB4F   cputyp   000C   cuddwn   FE01   datbox   F400   datsiz   0400   dboot    F925   dboot1   F930   dboot2   F93E   dboot3   F94D   dboot4   F956   dbsign   E800   debini   E804   debnmi   E802   del      FA5B   delay    FA59   digit    FFFB   dlen     001C   dmaadh   0010   dmaadl   0011   dmaltc   0013   doboot   FA53   dummy    F962   dump10   F981   dump20   F99A   dump30   F9B2   dump35   F9BC   dump40   F9BE   dump99   F9D2   dumpXY   F97F   exam99   F97E   examine  F963   figle2   F905   figle4   F91A   figle5   F922   figlef   F8F9   frqvec   000A   getadr   FBCB   getbyt   FBD7   getext   FBD5   gethex   FBEC   getnx2   FAF1   getnxt   FAE8   getpag   FAE2   gotmem   FA8A   hello    FC1D   hexbyt   FB87   hexdig   FB91   hexit    FBE9   hexwrd   FB83   hfail    FF42   hiadr    FFFE   hirom    FE10   ideadr0  0006   ideadr1  0008   ideadr2  000A   ideadr3  000C   idecmst  000E   idedat   0000   ideerft  0002   ider1    FA3C   idescnt  0004   idestat  0018   idigit   FC01   inch     FBA5   inchck   FB9D   ioseg    000E   irqvec   0000   isnrdy   FA11   jump99   FCC2   jumpprg  FCB9   k_u_map  FE02   kernel   000F   kextrn   FF90   kfirq    FF1F   kirq     FF07   knmi     FF11   knmix    FF1D   kreset   FF68   kresetx  FF84   krnrti   FEDA   kswi     FF87   kswi2    FF8A   kswi3    FF8D   ktrap    FF93   limit    FFF7   loadi1   F9F9   loadip   F9EB   loadxit  FA4B   lowadr   FFFC   lstmem   0014   mappe8   F9EA   mapper   F9E2   memfal   FAF2   memmsk   0017   mod10    FC61   mod20    FC92   mod30    FCA4   mod40    FCB0   mod50    FC9A   mod99    FCB2   modify   FC5A   modm00   FCB3   monpcra  F005   monpcrb  F007   monpdra  F004   monpdrb  F006   montor   F8B7   newlin   FB68   nmivec   0008   nomap    00FD   nomem    FA89   nothex   FC04   notimr   FB08   nxtcmd   F8C0   offset   FFF5   outch    FBBC   outchw   FBBE   outsp    FB7B   panic    FB56   panicy   FC4F   pcrlf    F9D6   pdata    FB70   pdata2   FB7A   prcs2    FE85   process  FE75   prompt   FC49   putch    FB6D   rammap   0100   remap    FEDE   rhexbyt  F80C   rinch    F806   rinchk   F804   rinit    F80E   rinit2   F83D   rinit4   F8AE   rinit8   F827   rinit9   F820   rinod    F875   romadr   F800   rommap   FEFF   romseg   000F   romspr   0018   romstk   BE80   routch   F808   rpdata   F80A   rrinit   F800   rtinit   F802   searc2   F8E0   search   F8D6   segadr   0010   segmax   0100   segmnt   FFF4   segsiz   1000   sorry    FC4C   stkcnt   FE00   sw2vec   0004   sw3vec   0006   swivec   0002   sysmap   0100   sysram   0100   sysres   0000   sysseg   0000   sysstk   BF38   syssu2   FA9C   syssu4   FAAD   syssu5   FAB7   syssu6   FAC3   syssup   FA92   systm1   FAD4   teluch   0016   tfrseg   000D   tinit    FC07   tinit2   FC16   UniFLEX Monitor ROM                  11:38:19  Jan 24, 2021   Page   27High-Level Interrupt Handling                       tlatch   FE03   tstloc   D0F0   tstpat   99AA   txtseg   0005   uargp    BF3C   ubasdp   00BF   ubasea   BF00   udummy   BF38   ufail    FF5B   ufirq    FE10   uflt     FE68   uirq     FE72   umapno   BF43   unfirq   FB41   unhand   FB1E   unmi     FE3B   unnmi    FB3A   unswi    FB25   unswi2   FB2C   unswi3   FB33   urelod   BF42   usercc   BF54   userd    BF55   useres   0001   userpb   BF5B   userpc   BF59   userx    BF57   usp      BF40   usrmap   BF44   usrrti   FECE   usrseg   000B   usrtop   000E   usrvec   FFE0   ustksz   BF3B   uswi     FE32   uswi2    FE6D   uswi2v   BF3E   uswi3    FE8D   uswi32   FEB2   uswi35   FEBC   utrap    FE37   vector   FFF0   waitrst  FA0E   