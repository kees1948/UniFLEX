#include <stdio.h>#include <stdint.h>#include <net.h>#define BUF_LEN      56#define PING_REQUEST 8#define PING_REPLY   0#define CODE_ZERO    0struct PING {uint8_t type;uint8_t code;int16_t chksum;int16_t pingid;int16_t pseq;uint8_t data[BUF_LEN];} myping;struct RBUF{struct PING recvping;char    dummy[128];     /* slack */} rbuf;uint16_t checksum(data_buf, len);int usage();int rserverlen;int main(argc, argv)int argc;char **argv;{    int sfdn, i=0, count =1, c;    struct sockaddr_in server, rserver;    uint32_t myaddr;    pflinit();    if (argc == 1)        usage();    sfdn = socket(AF_INET, SOCK_IPRAW,PROT_ICMP);    bzero(&server, sizeof(struct server));    server.sin_family = AF_INET;    server.sin_port = htons(3000);    server.sin_addr = htonl(inet_addr(argv[1]) );    bzero(&myping, sizeof(struct PING));    myping.type = PING_REQUEST;    myping.code = CODE_ZERO;    myping.chksum = 0;    myping.pingid = getpid();    for (i =0; i < BUF_LEN; i++)    {        myping.data[i] = i % 8;    }    fprintf(stdout,"PING %u.%u.%u.%u 64 bytes of data\n",                (uint8_t)(server.sin_addr >>24 & 0xff),                (uint8_t)(server.sin_addr >>16 & 0xff),                (uint8_t)(server.sin_addr >>8  & 0xff),                (uint8_t)(server.sin_addr &0xff)                );    while (1)    {        myping.chksum = 0;        myping.pseq = count;        myping.chksum = checksum ((char*)&myping, sizeof(myping));        i = sendto(sfdn, &myping, sizeof(struct PING), (struct sockaddrin*) &server, sizeof(server));        if (i == -1)        {            printf ("Sending ping failed!\n");            exit(1);        }        i = recvfrom(sfdn, (char*)&rbuf, sizeof(rbuf), (struct sockaddrin*) &rserver, &rserverlen);        if (i == -1)        {            printf ("Receiving ping failed!\n");            exit(1);        }        fprintf(stdout,"%d bytes from %u.%u.%u.%u: icmp_seq=%d ttl=128\n",                i,                (uint8_t)nothl((rserver.sin_addr >> 24 & 0xff)),                (uint8_t)nothl((rserver.sin_addr >> 16 & 0xff)),                (uint8_t)nothl((rserver.sin_addr >> 8  & 0xff)),                (uint8_t)nothl((rserver.sin_addr & 0xff)),                rbuf.recvping.pseq                );        fflush(stdout);        count++;         sleep(1);     }}int usage(){        fprintf(stderr, "usage:  ping server-IP \n");        exit(1);}