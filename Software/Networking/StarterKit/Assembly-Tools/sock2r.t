        opt nol        lib sysdef        lib sysints        lib syserrors        lib sysnet        opt lis,exp** copy socket data to file or stdout*start   equ     *        ldd     0,s         arg count        cmpd    #2        bne     80f        ldx     4,s         output file        stx     opfile        sys     ind,filopn        lbes    err1        std     wfdn** file IO set. open socket*80      sys     sksock,AF_INET,SOCK_STREAM,0        bec     01f        cmpd    #EINTR        lbne     err101        std     sfdn       save socket reference        bec     01f        cmpd    #EINTR        bne     err1** connect to server*01        ldd     #socklen        pshs    d        ldd     #sockad        pshs    d        lda     #skconn        pshs    a        ldd     sfdn        tfr     s,x        sys     indx        leas    5,s        bec     01f        cmpd    #EINTR        bne     err101        nop        bec     01f        cmpd    #EINTR        bne     err1** loop until EOF*01        ldd     sfdn        sys     read,buffer,512 fill buffer        bes     err1        nop        cmpd    #0              EOF?        beq     12f        std     rcnt            save count        pshs    d        ldd     #buffer        pshs    d        lda     #write        pshs    a        leax    0,s        ldd     wfdn        sys     indx        leas    5,s        bra 01b** done, close files*12      ldd     sfdn        sys     close        ldd     wfdn        sys     close        sys     termerr1    std     retval        ldd     sfdn        sys     close        ldd     #2        sys     write,errmsg,errlen        nop    sys termm1  fcc "open ",$d,0m1l equ *-m1m2  fcc "conn ",$d,0m2l equ *-m2m3  fcc "read ",$d,0m3l equ *-m3filopn  fcb    createopfile  fdb    0        fdb    3dowrite fcb write        fdb bufferrcnt    rzb 2sockad        fdb     AF_INET        fdb     32100        fcb     192,168,1,155socklen equ    *-sockadretval  rzb     2errmsg  fcc     "socket error",$derrlen  equ *-errmsgsfdn    rzb     2wfdn    fdb     1        org     (*+511)&512buffer  rmb    512        end     start