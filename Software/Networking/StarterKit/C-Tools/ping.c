#include <stdio.h>#include <net.h>#define BUF_LEN      56#define PING_REQUEST 8#define PING_REPLY   0#define CODE_ZERO    0struct PING {uint8_t type;uint8_t code;int16_t chksum;int16_t pingid;int16_t pseq;uint8_t data[BUF_LEN];} myping;struct RBUF{struct PING recvping;char    dummy[128];     /* slack */} rbuf;union L2B {uint8_t hex[4];uint32_t lv;} l2b;uint16_t checksum(data_buf, len);int usage();int rserverlen;int main(argc, argv)int argc;char **argv;{    int sfdn, i=0, count =1, c;    struct sockaddr_in server, rserver;    uint32_t myaddr;    if (argc == 1)        usage();    sfdn = socket(AF_INET, SOCK_IPRAW,PROT_ICMP);    bzero(&server, sizeof(struct server));    server.sin_family = AF_INET;    server.sin_port = 3000;    server.sin_addr = l2b.lv = (uint32_t) inet_addr(argv[1]) ;    bzero(&myping, sizeof(struct PING));    myping.type = PING_REQUEST;    myping.code = CODE_ZERO;    myping.chksum = 0;    myping.pingid = getpid();    for (i =0; i < BUF_LEN; i++)    {        myping.data[i] = i % 8;    }    fprintf(stdout,"PING %d.%d.%d.%d 64 bytes of data\n",                l2b.hex[0],                l2b.hex[1],                l2b.hex[2],                l2b.hex[3]);    while (1)    {        myping.chksum = 0;        myping.pseq = count;        myping.chksum = checksum ((char*)&myping, sizeof(myping));        i = sendto(sfdn, &myping, sizeof(struct PING), (struct sockaddrin*) &server, sizeof(server));        if (i == -1)        {            printf ("Sending ping failed!\n");            exit(1);        }        i = recvfrom(sfdn, (char*)&rbuf, sizeof(rbuf), (struct sockaddrin*) &rserver, &rserverlen);        if (i == -1)        {            printf ("Receiving ping failed!\n");            exit(1);        }        l2b.lv = rserver.sin_addr;        fprintf(stdout,"%d bytes from %d.%d.%d.%d: icmp_seq=%d ttl=128\n",                i,                l2b.hex[0],                l2b.hex[1],                l2b.hex[2],                l2b.hex[3],                rbuf.recvping.pseq                );        fflush(stdout);        count++;         sleep(1);     }}int usage(){        fprintf(stderr, "usage:  ping server-IP \n");        exit(1);}