          sttl    FIO        FIO IRQ code          pag** FIO interrupt handler, called when IRQ was set (interrupt context)* for regular NWP and IOP purpose*fio_irq   ldx     int_ptr    input message pointer          lda     cpu_fio    move REQUEST          sta     ,x+          ldd     cpu_fio1   sequence # TASK ID          std     ,x++          lda     cpu_fio2   specific DATA          sta     ,x+          ldd     cpu_fio3   device major/minor          std     ,x++          lda     cpu_fio5          sta     0,x+** X[0]=cmd,X[1][2]=task ID,X[3]=data, X[4][5]=device, X[6]=devtab*          ldu     fio_dsz          leau    -1,u          clr     0,u        cpu_fioF indicate message consumed*          stx     int_ptr    update pointer          ldy     #int_buf   get message from buffer          lda     0,y        -- Send interrupt command?          cmpa    #O_INTRPT          bne     30f** special case OOB signal*          sty     int_ptr    reset pointer          ldb     3,y        signal          ldx     4,y        DEVICE/SOCK reference*          jsr     sdev_sig   send device signal          bra     fiointe    exit** normal command* acquire free task slot*30        ldx     #tsktab     search for an available task          ldb     NUM_TSK    Number of tasks in system*32        lda     tsstat,x          cmpa    #TFREE     looking for a "free" task          beq     40f*          leax    TSKSIZ,x          decb          bne     32b*          ldb     #E_SYSBSY  can't process - IOP saturated!          jsr     fio_msg          bra     fiointe    exit** X[0]=cmd,X[1][2]=task ID,X[3]=data, X[4][5]=device, X[6]=device table* move data over into task struct*40        ldy     #int_buf   get message from buffer          sty     int_ptr    reset pointer          ldb     ,y+        command byte  REQUEST          stb     tscmd,x    save for task          ldd     ,y++       sequence #    task ID          std     tsseq,x          ldb     ,y+        command specific DATA          stb     tstval,x          ldd     ,y++       associate with terminal major/minor          std     tsdev,x          lda     ,y+          sta     tsdtix,x   device table index          jsr     makrdy     make task ready to run*fiointe   rts                exit