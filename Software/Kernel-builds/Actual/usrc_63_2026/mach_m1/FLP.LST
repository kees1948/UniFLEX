                               opt    lis,exp                     UniFLEX    Operating System (C)1     18:14:42  Jun 13, 2025   Page    1Floppy Drivers                                                                     name   flpdrvr                               global flpopen,flpclos,flpio,flpirq                               global flopen,flclos,flread,flwrit,flspcl                                          *  0000 0000          FDtable   fdb    0         Block Device Table address  0002 00 00         swpbtp    rzb    2         swap page table pointer                                          *                     * per drive tables  0004 00 00 00 00   flptab    rzb    FLTBSZ    per drive details                                          * ttyget/ttyset area                     * flpcot[], flpopt[], flpsts[], flpstd[]  0018 00 00 00 00   flpwrk    fcb    0,0,0,0,0,0                                          *                     * open the flp disk drive - insure the device is online, etc.                     * B contains device minor                     *  001E 34   06       flpopen   pshs   d  0020 C1   05                 cmpb   #MAXDEV   total max devices >0022 1024 006A               lbhs   flpaer    invalid drive                     *+ 0026 8E   0004               ldx    #flptab  0029 C1   04                 cmpb   #MAXFLP   special device  002B 25   14                 blo    01f                     * for FL no extra test  002D 34   04                 pshs   b  002F EC   84                 ldd    flpcot,x  dev 0,1  0031 26   19                 bne    dvbsye    others are open  0033 EC   02                 ldd    flpcot+2,x dev 2,3  0035 26   15                 bne    dvbsye  0037 EC   05                 ldd    flpopt,x  same for block  0039 26   11                 bne    dvbsye  003B EC   07                 ldd    flpopt+2,x  003D 26   0D                 bne    dvbsye  003F 35   04                 puls   b                     * allow open  0041 3A            01        abx  0042 1F   13                 tfr    x,u  0044 6D   45                 tst    flpopt,u  0046 27   0B                 beq    flpop2  0048 6C   45                 inc    flpopt,u  004A 20   49                 bra    flpop3                       004C 35   04       dvbsye    puls   b  004E 86   10                 lda    #EBSY >0050 16   003F               lbra   flpext                     *  0053 6C   45       flpop2    inc    flpopt,u  set open  0055 6F   4A                 clr    flpsts,uUniFLEX    Operating System (C)1     18:14:43  Jun 13, 2025   Page    2Floppy Drivers                                        0057 6F   4F                 clr    flpstd,u  0059 86   01                 lda    #1  005B B7   E00A               sta    flpdpr+flnwop new open                                          *                     * try to read disk as 8" SD, 8" DD, 5" SD and 5" DD                     * As we want to read the SIR, which is block 1 there is no                     * worry about side select. If SIR is read, the real SIDE/SIZE/DENS                     * info is taken from the SIR                     *  005E EC   E4       flpop7    ldd    0,s       get device#  0060 8D   64                 bsr    frdsir    read SIR SD/8"  0062 27   33                 beq    flpop4X 0064 7F   0000               clr    uerrorX 0067 BD   0000               jsr    freebf    free the buffer                     *  006A A6   4F                 lda    flpstd,u  006C 88   01                 eora   #%00000001  006E A7   4F                 sta    flpstd,u  toggle dens                     *  0070 EC   E4                 ldd    0,s       get device# again  0072 8D   52                 bsr    frdsir    read SIR DD/8"  0074 27   21                 beq    flpop4    no errorX 0076 7F   0000               clr    uerrorX 0079 BD   0000               jsr    freebf                     *  007C A6   4F                 lda    flpstd,u  007E 88   01                 eora   #%00000001  0080 A7   4F                 sta    flpstd,u  toggle dens                     *  0082 A6   4A                 lda    flpsts,u  0084 88   40                 eora   #%01000000 5/8" select  0086 A7   4A                 sta    flpsts,u  0088 84   40                 anda   #%01000000 done already  008A 26   D2                 bne    flpop7                     *  008C EC   E4                 ldd    0,s  008E 8D   2B                 bsr    flpclos  0090 86   01       flpaer    lda    #EIO      set IO errorX 0092 B7   0000     flpext    sta    uerror  0095 35   86       flpop3    puls   d,pc      return                     *  0097 34   60       flpop4    pshs   y,u       save buffer  0099 AE   E4                 ldx    0,s       buf ptr+ 009B 108E 0018               ldy    #flpwrk   destination data locationX 009F CE   0000               ldu    #sdenf    source data, offset in SIR  00A2 CC   0002               ldd    #2        2 bytes(ttyget/set)X 00A5 BD   0000               jsr    cpybts  00A8 EE   62                 ldu    2,s       device info+ 00AA B6   0019               lda    flpwrk+1  00AD A7   4A                 sta    flpsts,u  side info+ 00AF B6   0018               lda    flpwrkUniFLEX    Operating System (C)1     18:14:43  Jun 13, 2025   Page    3Floppy Drivers                                        00B2 A7   4F                 sta    flpstd,u  dens info  00B4 35   60                 puls   y,uX 00B6 BD   0000               jsr    freebf  00B9 35   86                 puls   d,pc                                          * flp close  00BB               flpclos+ 00BB 8E   0004               ldx    #flptab  00BE 3A                      abx  00BF 6A   05                 dec    flpopt,x  dec open counter  00C1 2A   02                 bpl    flpcl1  00C3 6F   05                 clr    flpopt,x  clear open status  00C5 39            flpcl1    rts              return                                          *                     * frdsir, read floppy SIR into a buffer                     * D is device                     * Y.X is block number                     *  00C6 34   40       frdsir    pshs   u  00C8 8E   0001               ldx    #1  00CB 108E 0000               ldy    #0X 00CF BD   0000               jsr    rdbuf  00D2 A6   28                 lda    bfflag,y  00D4 85   04                 bita   #BFERR  00D6 35   C0                 puls   u,pc                                          *                     * fire up FLP operation to initiate transfer                     * Y = buf header                     * most is done in interrupt handler                     *+ 00D8 BF   0000     flpio     stx    FDtable   save Block Device Table addressX 00DB 7C   0008               inc    flpdt+dtbusy mark busy  00DE EC   2A                 ldd    bfdvn,y   get device #  00E0 F7   E009               stb    flpdpr+fldriv  00E3 B7   E001               sta    flpdpr+flblkh unused for floppy address  00E6 CE   E000               ldu    #flpdpr                     *  00E9 86   01                 lda    #1        set funcX 00EB B7   0009               sta    flpdt+dtrtry                     *+ 00EE 8E   0004               ldx    #flptab  00F1 3A                      abx  00F2 A6   0A                 lda    flpsts,x  00F4 A7   4B                 sta    fltsid,u  00F6 A6   0F                 lda    flpstd,x  get dens flpstd  00F8 A7   4C                 sta    fltden,u                     *                     * 'standard' sizes 128/256/512  00FA 8E   0000               ldx    #0        init field  00FD AF   46                 stx    fltxfr,uUniFLEX    Operating System (C)1     18:14:43  Jun 13, 2025   Page    4Floppy Drivers                                                           * set action  00FF A6   28                 lda    bfflag,y  R/W  0101 A7   C4                 sta    flrflg,u                     *  0103 AE   A8 12              ldx    bfxfc,y   get transfer count  0106 AF   44                 stx    fltsiz,u  TOTAL size  0108 8C   0010               cmpx   #16       swap? >010B 1023 006F               lbls   doswap                                          *                     * single block read/write                     *  010F 85   10                 bita   #BFRWF  0111 26   4D                 bne    02f       read=1, go wait                     *                     * write, transfer data to FIFO first                     *                     *  0113 34   06                 pshs   d         make space for sizeX 0115 F6   000C               ldb    DATBOX+SBUF save DAT setting  0118 34   74                 pshs   b,x,y,u  011A EC   A8 12              ldd    bfxfc,y  011D 1083 0200               cmpd   #BUFSIZ   max data xfer in DPR  0121 23   03                 bls    01f                     *  0123 CC   0200     splb01    ldd    #BUFSIZ  0126 ED   67       01        std    7,s       count [D]                     *  0128 E3   46                 addd   fltxfr,u  actual xfer  012A ED   46                 std    fltxfr,u                     *                     * use kernel functions for transfer                     *  012C EC   67                 ldd    7,s       count [D]  012E 31   C8 20              leay   flpfifo,u system target  0131 CE   0000               ldu    #0        offset  0134 AE   63                 ldx    3,s       bufhdr [Y]  0136 34   01                 pshs   cc  0138                         seti  0138 1A   50                 orcc   #FF|IF                               endmX 013A BD   0000               jsr    cpybts  013D 35   01                 puls   cc  013F 35   74                 puls   b,x,y,uX 0141 F7   000C               stb    DATBOX+SBUF save DAT setting                     *  0144 A6   28                 lda    bfflag,y  0146 85   80                 bita   #BFSPC    special function  0148 27   14                 beq    11f                     *                     * adjust for (bulk) data transfer                     *UniFLEX    Operating System (C)1     18:14:44  Jun 13, 2025   Page    5Floppy Drivers                                        014A EC   A8 12              ldd    bfxfc,y   decrease transfer count  014D A3   E4                 subd   0,s       deduct that we do now  014F ED   A8 12              std    bfxfc,y  0152 EC   A8 10              ldd    bfadr,y   buffer (memory) address  0155 E3   E4                 addd   0,s       update pointer  0157 ED   A8 10              std    bfadr,y   updated memory address  015A 24   02                 bcc    11f  015C 6C   2F                 inc    bfxadr,y  hibyte  (A16...A19)  015E 35   06       11        puls   d         empty stack                     *                     * read, send command, in interrupt data is there (or not)                     *  0160 A6   2C       02        lda    bfblch,y  BLOCK# H/M/L  0162 A7   41                 sta    flblkh,u  0164 EC   2D                 ldd    bfblck,y  0166 ED   42                 std    flblkm,u                     *  0168 86   FF                 lda    #$ff      set command location GPP  016A A7   C9 03FF            sta    flptel,u  016E 39                      rts                     *                     * some error had occurred                     *  016F 86   12       01        lda    #EBDEVX 0171 B7   0000               sta    uerror  0174 A6   28                 lda    bfflag,y  0176 8A   04                 ora    #BFERR  0178 A7   28                 sta    bfflag,y                     *X 017A 7F   0009     flpfin    clr    flpdt+dtrtry erase function  017D 39                      rts                       017E 86   02       doswap    lda    #2        set swap modeX 0180 B7   0009               sta    flpdt+dtrtry  0183 EC   A8 10              ldd    bfadr,y   save address of swap page table+ 0186 FD   0002               std    swpbtp+>0189 BD   01AE               jsr    flsetba   make current bufhdr to point  018C 1026 00A1               lbne   flpdon    to memory page(s)                     *                     * bufhdr now points to memory page                     *  0190 8E   1000               ldx    #PAGSIZ   page size  0193 AF   44                 stx    fltsiz,u  TOTAL size                       0195 8E   0000               ldx    #0        init field  0198 AF   46                 stx    fltxfr,u                     *  019A A6   28                 lda    bfflag,y  read/write?  019C 85   10                 bita   #BFRWF  019E 27   07                 beq    03f  01A0 CC   0200               ldd    #BUFSIZ  01A3 ED   46                 std    fltxfr,uUniFLEX    Operating System (C)1     18:14:44  Jun 13, 2025   Page    6Floppy Drivers                                        01A5 20   B9                 bra    02b                     * load 1st buffer  01A7 34   06       03        pshs   d         create space  01A9 34   74                 pshs   b,x,y,u  01AB 16   FF75               lbra   splb01    write                     *                     * flsetba, flop setup bufhdr for swap transfer                     *  01AE 34   10       flsetba   pshs   x+ 01B0 BE   0002               ldx    swpbtp    copy of original bfaddr  01B3 E6   80                 ldb    0,x+      get page#+ 01B5 BF   0002               stx    swpbtpX 01B8 F1   0000               cmpb   DSKTRM    passed last age?  01BB 26   03                 bne    01f  01BD 5F                      clrb             set end  01BE 35   90                 puls   x,pc                     *  01C0 86   10       01        lda    #16       shift page left by 4 into D  01C2 3D                      mul  01C3 ED   2F                 std    bfxadr,y  set real memory address A19...A8  01C5 6F   A8 11              clr    bfadr+1,y A7...A0  01C8 1C   FB                 clz  01CA 35   90                 puls   x,pc                                          *                     * IRQ, here most things are done (success or fail)                     *+              01CC  flpirq    equ    *  01CC CE   E000               ldu    #flpdpr   hardware base address  01CF 6F   C9 03FE            clr    flpint,u  set we saw it                     *X 01D3 10BE 0004               ldy    flpdt+dtqfl get last transaction  01D7 27   A1                 beq    flpfin    Y = bufhdr  01D9 A6   28                 lda    bfflag,y  get bufhfr flags  01DB E6   48                 ldb    flstat,u  result  01DD 26   36                 bne    flprr1                     *  01DF 85   80                 bita   #BFSPC    special action (bulk)  01E1 26   5A                 bne    flirrw                     *  01E3 AE   44                 ldx    fltsiz,u  special action (swap)  01E5 8C   1000               cmpx   #PAGSIZ  01E8 1027 00BB               lbeq   intswp    do swap                     *                     * single block transfers, Write= done, Read is get data                     *  01EC 85   10                 bita   #BFRWF    read=1  01EE 27   23                 beq    03f       for write we're finished                     *                     * interrupt context, be careful, buffer may be in use                     * READ                     *UniFLEX    Operating System (C)1     18:14:44  Jun 13, 2025   Page    7Floppy Drivers                                      X 01F0 F6   000C               ldb    DATBOX+SBUF save DAT setting  01F3 34   74                 pshs   b,x,y,u  01F5 EC   A8 12              ldd    bfxfc,y  01F8 1083 0200               cmpd   #BUFSIZ   max data xfer  01FC 23   03                 bls    10f  01FE CC   0200               ldd    #BUFSIZ  0201 ED   46       10        std    fltxfr,u  count  0203 31   C8 20              leay   flpfifo,u system target  0206 CE   0000               ldu    #0        offset  0209 AE   63                 ldx    3,s       bufhdr [Y]X 020B BD   0000               jsr    cpystb  020E 35   74                 puls   b,x,y,uX 0210 F7   000C               stb    DATBOX+SBUF restore DAT setting                     *                     * for write (and single read), we're done                     *  0213 20   1C       03        bra    flpdon                                          * handle errors A= bfflag  0215 E7   A8 14    flprr1    stb    bfstat,y  device status byte  0218 8A   04                 ora    #BFERR  021A A7   28                 sta    bfflag,y  set error result bit  021C C5   40                 bitb   #%01000000 write protect  021E 27   04                 beq    01f       2793  0220 86   0A                 lda    #EPRM  0222 20   0A                 bra    02f  0224 C5   10       01        bitb   #%00010000 not found  0226 27   04                 beq    03f       2793  0228 86   07                 lda    #EBADF  022A 20   02                 bra    02f  022C 86   01       03        lda    #EIO      all othersX 022E B7   0000     02        sta    uerror                     *                     * wrap up and return form call                     *X 0231 7F   0008     flpdon    clr    flpdt+dtbusy set unbusyX 0234 7F   0009               clr    flpdt+dtrtry clear funtion+ 0237 BE   0000               ldx    FDtableX 023A 7E   0000               jmp    BDioend                                          *                     * BULK data transfer                     * for Read and Write, tranfer next data block(s)                     * A=bfflag                     *+              023D  flirrw    equ    *  023D 84   10                 anda   #BFRWF  023F 34   02                 pshs   a         +1 direction flag  0241 27   07                 beq    09f                     * BULK Read  0243 EC   46                 ldd    fltxfr,u  what we got already  0245 10A3 44                 cmpd   fltsiz,u  set by read commandUniFLEX    Operating System (C)1     18:14:45  Jun 13, 2025   Page    8Floppy Drivers                                        0248 24   05                 bhs    11f                     * BULK  Read/Write  024A EC   A8 12    09        ldd    bfxfc,y   any data ?  024D 26   04                 bne    10f                     *                     * transfer completed, bail out                     *  024F 32   61       11        leas   1,s       clean stack  0251 20   DE                 bra    flpdon                     *                     * common code for Read/Write                     *  0253 1083 0200     10        cmpd   #BUFSIZ  0257 23   03                 bls    02f  0259 CC   0200               ldd    #BUFSIZ                     * transfer next block  025C 34   06       02        pshs   d         +2 count                     *X 025E F6   000C               ldb    DATBOX+SBUF save old value  0261 34   74                 pshs   b,x,y,u   +7                     *  0263 1F   21       swpinx    tfr    y,x       bufhdr  0265 31   C8 20              leay   flpfifo,u system target  0268 EC   67                 ldd    7,s       count [D]  026A CE   0000               ldu    #0        offset                     * function to do  026D 6D   69                 tst    9,s       0 = write, <>0 is read  026F 27   05                 beq    14f       read: DPR -> memX 0271 BD   0000               jsr    cpystb  0274 20   03                 bra    15f                     *X 0276 BD   0000     14        jsr    cpybts    write: mem > DPR                     *  0279 35   74       15        puls   b,x,y,u   -7, leave counts and flag in stackX 027B F7   000C               stb    DATBOX+SBUF                     * count and flag still on stack  027E A6   28                 lda    bfflag,y  0280 85   80                 bita   #BFSPC  0282 27   14                 beq    06f                     *                     * adjust for transferred data                     *  0284 EC   A8 12              ldd    bfxfc,y   process data done  0287 A3   E4                 subd   0,s       always less then 65K  0289 ED   A8 12              std    bfxfc,y  028C EC   A8 10              ldd    bfadr,y   update memory pointer  028F E3   E4                 addd   0,s  0291 ED   A8 10              std    bfadr,y  0294 24   02                 bcc    06f  0296 6C   2F                 inc    bfxadr,y                     *  0298 EC   46       06        ldd    fltxfr,uUniFLEX    Operating System (C)1     18:14:45  Jun 13, 2025   Page    9Floppy Drivers                                        029A E3   E1                 addd   0,s++     -2, correct stack  029C ED   46                 std    fltxfr,u                     *  029E 35   02                 puls   a         cleanup stack  02A0 86   FF                 lda    #$ff  02A2 A7   C9 03FF            sta    flptel,u  02A6 39                      rts                                          *                     *  U=fifo address, X=data size, Y=bufhdr                     *+              02A7  intswp    equ    *         do swap operations  02A7 AE   46                 ldx    fltxfr,u  02A9 AC   44                 cmpx   fltsiz,u  is updated each transfer set to PAGSIZ  02AB 27   1A                 beq    01f       try next page                     *                     * swap per block                     *  02AD EC   2D       02        ldd    bfblck,y  select next block  02AF                         incd  02AF 104C                    fdb    $104c                               endm  02B1 ED   2D                 std    bfblck,y  02B3 ED   42                 std    flblkm,u  set new block select                     *  02B5 A6   28                 lda    bfflag,y  02B7 84   10                 anda   #BFRWF  02B9 34   02                 pshs   a         +1 build stack  02BB CC   0200               ldd    #BUFSIZ  02BE 34   06                 pshs   d         +2                     *X 02C0 F6   000C               ldb    DATBOX+SBUF save old value  02C3 34   74                 pshs   b,x,y,u   +7  02C5 20   9C                 bra    swpinx                     *                     * one page finished                     *+ 02C7 BD   01AE     01        jsr    flsetba   setup for next PAGE  02CA 1027 FF63               lbeq   flpdon    zero is done                     *  02CE 8E   0000               ldx    #0        reset transferred  02D1 AF   46                 stx    fltxfr,u  02D3 20   D8                 bra    02b                                          *                     *  character open                     *+              02D5  flopen    equ    *  02D5 C1   05                 cmpb   #MAXDEV  02D7 24   2E                 bhs    flchop4                     + 02D9 8E   0004               ldx    #flptabUniFLEX    Operating System (C)1     18:14:45  Jun 13, 2025   Page   10Floppy Drivers                                        02DC C1   04                 cmpb   #MAXFLP  02DE 25   14                 blo    01f                     *  02E0 34   04                 pshs   b  02E2 EC   84                 ldd    flpcot,x  check is anything is open  02E4 26   1F                 bne    flcho01  02E6 EC   02                 ldd    flpcot+2,x  02E8 26   1B                 bne    flcho01  02EA EC   05                 ldd    flpopt,x  02EC 26   17                 bne    flcho01  02EE EC   07                 ldd    flpopt+2,x  02F0 26   13                 bne    flcho01  02F2 35   04                 puls   b                     *  02F4 3A            01        abx  02F5 6D   84                 tst    flpcot,x  02F7 26   13                 bne    flchop5   don't touch settings  02F9 6C   84                 inc    flpcot,x  02FB 6D   05                 tst    flpopt,x  is block driver alrady open?  02FD 26   0D                 bne    flchop5   yes, don't do anything  02FF 6F   0A                 clr    flpsts,x  clear side/size info  0301 6F   0F                 clr    flpstd,x  clear dens info  0303 20   07                 bra    flchop5                       0305 35   04       flcho01   puls   b                                          *  0307 86   0C       flchop4   lda    #EBARGX 0309 B7   0000               sta    uerror  030C 39            flchop5   rts                                          *                     * character close                     *+ 030D 8E   0004     flclos    ldx    #flptab  0310 3A                      abx  0311 6F   84                 clr    flpcot,x  0313 39                      rts                                          *                     * flchrd                     *+              0314  flread    equ    *  0314 34   06                 pshs   d         save device numberX 0316 108E 0000               ldy    #fchbufX 031A BD   0000               jsr    blkgtb    get device buffer  031D 35   06                 puls   d+>031F BD   035F               jsr    fchcn     configure bufferX 0322 7D   0000               tst    uerror    OK?  0325 27   0B                 beq    fchrd4  0327 34   20                 pshs   yX 0329 108E 0000               ldy    #fchbufUniFLEX    Operating System (C)1     18:14:46  Jun 13, 2025   Page   11Floppy Drivers                                      X 032D BD   0000               jsr    blkfrb    free the buffer  0330 35   A0                 puls   y,pc      error return                       0332 34   02       fchrd4    pshs   a         save task mode byte  0334 CA   10                 orb    #BFRWF    set read  0336 E7   28                 stb    bfflag,y  save  0338 20   20                 bra    fchio                                          *                     * flchwr                     *+              033A  flwrit    equ    *  033A 34   06                 pshs   d         save device infoX 033C 108E 0000               ldy    #fchbufX 0340 BD   0000               jsr    blkgtb    get device buffer  0343 35   06                 puls   d+>0345 BD   035F               jsr    fchcn     configureX 0348 7D   0000               tst    uerror    OK  034B 27   0B                 beq    fchwr4  034D 34   20                 pshs   yX 034F 108E 0000               ldy    #fchbufX 0353 BD   0000               jsr    blkfrb    free the buffer  0356 35   A0                 puls   y,pc      error return                       0358 34   02       fchwr4    pshs   a         save task mode byte                     X 035A C6   00       fchio     ldb    #FLmajorX 035C 7E   0000               jmp    blkcio                                          *                     * fchcn                     *                     * Configure the buffer header pointed at by Y.                     * This routine sets up the character device info                     * from the user block and puts it in the buffer                     * header such that the device drivers can use                     * the informationfor the transfer                     * this routine is specific for the floppy driver                     *  035F ED   2A       fchcn     std    bfdvn,y   save device infoX 0361 FC   0000               ldd    uicnt     xfr count  0364 ED   A8 12              std    bfxfc,y  0367 1083 0080               cmpd   #128      check valid numbers  036B 27   33                 beq    fcnch4  036D 1083 0100               cmpd   #256  0371 27   2D                 beq    fcnch4  0373 1083 0200               cmpd   #512  0377 27   27                 beq    fcnch4                     *                     * above are valid sector sizes                     *  0379 34   10                 pshs   xUniFLEX    Operating System (C)1     18:14:46  Jun 13, 2025   Page   12Floppy Drivers                                      + 037B 8E   03A3               ldx    #tsztab  037E 10A3 81       fcnctb    cmpd   0,x++  0381 27   0C                 beq    fcnch2  0383 6D   84                 tst    0,x  0385 26   F7                 bne    fcnctb  0387 35   10                 puls   x                     *  0389 86   0C       fcnch8    lda    #EBARG    set errorX 038B B7   0000               sta    uerror  038E 39                      rts                     *  038F 35   10       fcnch2    puls   xX 0391 FC   0000               ldd    uistrt    (big) buffer aligned at 512  0394                         bitdi  $01ff     byte boundary?  0394 1085                    fdb    $1085  0396 01FF                    fdb    $01ff                               endm  0398 26   EF                 bne    fcnch8                     *  039A A6   28                 lda    bfflag,y  039C 8A   80                 ora    #BFSPC    special bit for drivers  039E A7   28                 sta    bfflag,y                     *                     * do the remainder in the common code                     * seek offset and real memory address                     *X 03A0 7E   0000     fcnch4    jmp    blkcnf                     *                     * valid track sizes                     * 5" SD, 8" SD, 5" DD, 8" DD, HD, (legay) 5" SD, 8" SD, 5" DD, 8" DD, HD RTRK                     *  03A3 0C35 1443     tsztab    fdb    3125,5187,6250,10375,12500,3050,5100,6100,10200,12200,12500,0                                          *                     * flspcl                     *  03BB               flspcl  03BB 1F   12                 tfr    x,y+ 03BD 8E   0004               ldx    #flptab   side info table  03C0 3A                      abx                     * set/get?  03C1 108C 0000               cmpy   #0  03C5 26   0E                 bne    01f                     * setX 03C7 FC   0000               ldd    usarg0  03CA A7   0F                 sta    flpstd,x  set side  03CC E7   0F                 stb    flpstd,x  set densX 03CE FC   0000               ldd    usarg2    hardware  03D1 FD   E3F0               std    flpdpr+flpstp  03D4 39                      rts                     * get  03D5 A6   0A       01        lda    flpsts,x  get sideUniFLEX    Operating System (C)1     18:14:46  Jun 13, 2025   Page   13Floppy Drivers                                        03D7 E6   0F                 ldb    flpstd,x  get dens  03D9 ED   A4                 std    0,y  03DB B6   E008               lda    flpdpr+flstat  03DE A7   22                 sta    2,y  03E0 6F   23                 clr    3,y  03E2 FC   E3F0               ldd    flpdpr+flpstp  03E5 ED   24                 std    4,y                                                    end0 Error(s) detected     6 Excessive BRANCH/JUMP(S) detectedLength of Text Segment: 0000Length of Data Segment: 03E7Length of Bss Segment:  0000UniFLEX    Operating System (C)1     18:14:46  Jun 13, 2025   Page   14Floppy Drivers                                      Symbol Table:Absolute Symbols:A        0008   ALARMS   000A   B        0009   BADBFD   0002   BARGS    0007   BFALOC   0001   BFERR    0004   BFIOF    0002   BFLAT    0040   BFNOW    0020   BFREQ    0008   BFRWF    0010   BFSPC    0080   BLKSIZ   000F   BSPCH    007F   BUFPR    0032   BUFSIZ   0200   CBIT     0001   CC       000A   CDBLKS   0064   CFDN     0032   CNCLC    0018   CR       000D   D        0000   DBG      0000   DBGA     0000   DIRSIZ   000E   DP       000B   DPLCNT   000A   DPLSIZ   0009   DRVPAG   0009   DSKADS   0003   DVTSIZ   000C   E        000E   EARGC    0013   EBADF    0007   EBARG    000C   EBBIG    0016   EBDCL    001A   EBDEV    0012   EBIT     0080   EBSY     0010   ECN      0000   EDFUL    0005   EDTOF    0003   EFAULT   0002   EFLX     000B   EINTR    001B   EIO      0001   EISDR    0014   ELOCK    001F   EMSDR    0009   EMT2S    0008   EMTS     0004   ENBLK    000F   ENCHD    0018   ENDR     0004   ENMNT    0011   ENOFL    0008   ENOTB    0015   ENTSK    001C   ENTTY    001D   EOTCH    0004   EPIPE    001E   EPRM     000A   ESEEK    000D   ESOCK    0020   ESTOF    0017   ETMFL    0006   ETMTS    0019   EXCSIZ   0008   EXDEV    000E   F        000F   FALTS    0007   FDNPR    0064   FF       0040   FLP      0001   FLTBSZ   0014   GPPDBG   0001   HANGS    0001   HDRSIZ   0018   HOLDC    001B   IDE      0001   IF       0010   INTRC    0003   INTS     0002   IOP      0000   IS       0003   IU       0002   IX       0000   IY       0001   KBOLT    000A   KILLS    0005   LOOP     0001   MAPSIZ   000D   MAXDEV   0005   MAXFLP   0004   MAXPAG   0100   MAXPAGES 0010   MAXPIP   1000   MXUMEM   FE00   NET      0001   NETBLCK  0000   NFDNPR   0050   NL       000A   NOACIA   0000   NODEV    FFFF   NONRAM   00F0   PAGSIZ   1000   PC       0005   PIPEPR   FFFB   PRCSIZ   0100   PTTY     0001   QUITC    001C   QUITS    0003   RAMDSK   0000   REGSIZ   0008   RESTM    0009   ROMDBG   0000   S        0004   SBUF     000C   SBUFFR   C000   SHMEM    0000   SIGCNT   000C   SLEPPR   FFB0   SMAPSZ   0100   SPACE    0020   SPI      0000   STABPG   0001   STKOFS   0F38   SWAPPR   0078   SYSBLK   000F   SYSLOC   0000   SYSPAG   0000   SYSSTK   BF38   SYSTXT   0005   TABCH    0009   TERMS    000B   TIMES    0009   TRACS    0008   TTYIPR   FFF6   TTYOPR   FFEC   U        0003   UA       0001   UB       0002   UCC      0000   UD       0001   UIO      0000   UNFILS   0010   UPB      0007   UPC      0005   USERBL   BF38   USERPR   FFA6   USERS    000C   USRLOC   000B   USTKO    0E00   UX       0003   V        0007   VID      0000   W        0006   WAITPR   FFD8   WBUFPR   001E   WMEMPR   FFFB   WPIPES   0006   X        0001   XBUF     000D   XBUFFR   D000   XOFFC    0013   XONC     0011   Y        0002   Z0       000C   Z1       000D   bfadr    0010   bfblch   000C   bfblck   000D   bfdbl    0002   bfdfl    0000   bfdvn    000A   bffbl    0006   bfffl    0004   bfflag   0008   bfflg2   0009   bfspr    0015   bfstat   0014   bfxadr   000F   bfxfc    0012   blkcls   0004   blkio    0008   blkmdm   000E   blkopn   0000   blktpt   000C   dtbusy   0008   dtdbl    0002   dtdfl    0000   dtqbl    0006   dtqfl    0004   dtrtry   0009   dtspr    000A   fcp2io   03FD   fio2cp   03FC   flblkh   0001   flblkl   0003   flblkm   0002   fldriv   0009   flnwop   000A   flpcot   0000   flpdpr   E000   flpfifo  0020   flpint   03FE   flpopt   0005   flpstd   000F   flpstp   03F0   flpsts   000A   flptel   03FF   flrflg   0000   flstat   0008   fltden   000C   fltsid   000B   fltsiz   0004   fltxfr   0006   UniFLEX    Operating System (C)1     18:14:47  Jun 13, 2025   Page   15Floppy Drivers                                      Text Segment Symbols:     NoneData Segment Symbols:FDtable  0000   doswap   017E   dvbsye   004C   fchcn    035F   fchio    035A   fchrd4   0332   fchwr4   0358   fcnch2   038F   fcnch4   03A0   fcnch8   0389   fcnctb   037E   flcho01  0305   flchop4  0307   flchop5  030C   flclos   030D   flirrw   023D   flopen   02D5   flpaer   0090   flpcl1   00C5   flpclos  00BB   flpdon   0231   flpext   0092   flpfin   017A   flpio    00D8   flpirq   01CC   flpop2   0053   flpop3   0095   flpop4   0097   flpop7   005E   flpopen  001E   flprr1   0215   flptab   0004   flpwrk   0018   flread   0314   flsetba  01AE   flspcl   03BB   flwrit   033A   frdsir   00C6   intswp   02A7   splb01   0123   swpbtp   0002   swpinx   0263   tsztab   03A3   Bss Segment Symbols:     NoneExternal Symbols:BDioend  0000   DATBOX   0000   DSKTRM   0000   FLmajor  0000   blkcio   0000   blkcnf   0000   blkfrb   0000   blkgtb   0000   cpybts   0000   cpystb   0000   fchbuf   0000   flpdt    0000   freebf   0000   rdbuf    0000   sdenf    0000   uerror   0000   uicnt    0000   uistrt   0000   usarg0   0000   usarg2   0000   