** slave driver for PTY's pseudo tty*        lib     ../mach_m1/sysconfig.h        if      (PTTY=1)        lib     ./gendrvr.h        lib     ../include/tty.h        lib     ../include/ust.h        lib     ../include/sysdefs.h        lib     ../include/inttab.h        data        global  ptysop,ptyscl,ptysrd,ptyswr,ptysspptysop  equ     *        bsr     ptgxtb        beq     ptyer2        rtsptyer2  tstb        beq     01fptyer1  lda     #EBDEV        sta     uerror01      rtsptyscl  equ     *        bsr     ptgxtb        beq     ptyer1        jsr     flusht          empty buffers        ldd     #HANGS        jsr     intrpt          send hangup        rtsptysrd  equ     *        bsr     ptgxtb        beq     ptyer1        lda     #1        sta     uiosp02      ldy     tqout,x        jsr     getc            get char from queue        bmi     01f        jsr     passc           to user        bra     02b01      ldy     tqout,x        jsr     wakeup          wake sleepers        rtsptyswr  equ     *        bsr     ptgxtb        beq     ptyer1        lda     #1        sta     uiosp02      jsr     cpass        bmi     01f        jsr     ttyin        bra     02b01      ldy     tqin,x        jsr     wakeup        rtsptgxtb  pshs    d        subb    minpty        bmi     ptxer1        cmpb    #MAXPTY        bhs     ptxer1*        ldb     1,s             restore B        ldx     ttytab        lda     #TTYSIZ        mul        leax    d,x        ldd     instat,x      address MUST be zero*        bne     ptxer1        lda     #101      puls    d,pcptxer1  clra        bra     01bptyssp  equ     *        tfr     x,y*        bsr     ptgxtb*        beq     ptyer1        sty     -2,s        beq     ptyset*ptyget  lda     minpty        ldb     #MAXPTY        std     0,y        ldd     #0        std     2,y        std     4,y        rtsptyset        rts        endif        end