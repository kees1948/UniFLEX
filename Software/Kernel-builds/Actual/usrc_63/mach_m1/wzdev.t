        opt     nol        lib     sysconfig.h        if      ((NET=1)|(NETBLCK=1))        lib     ../include/params.h        lib     ../include/macdefs.h        lib     ../include/wzsock.h        lib     ../include/fio.h        lib     ../include/fio_ctrl.h        lib     ../include/nwp_codes.h        opt     lis        data** basic net device* its purpose is to set the local side* of the w5500 device*        global  wzopn,wzcls,wzrdd,wzwrd,wzspc* regular socket interface deviceMAXNET  set     0        if      (NET=1)MAXNET  set     1        endif* netblock device and NO socket device        if      (NETBLCK=1)MAXNET  set     1        endifMX_NETD equ     MAXNETwzcurd  rzb     1wzopfl  rzb     3wzopn   equ     *        pshs    x,y,u        ldx     #wzopfl        cmpb    #MX_NETD        bhs     03f        abx        tst     0,x        bne     01f        inc     0,x        stb     wzcurd          set currents device02      puls    x,y,u,pc03      lda     #EBARG        bra     04f01      lda     #EBSY04      sta     uerror        bra     02bwzcls   equ     *        ldx     #wzopfl        cmpb    #MX_NETD        bhs     03b        abx        clr     0,x        rts** read configuration data, B=minor*wzrdd   equ     *        pshs    x,y,u        ldy     #NWP0           get parameter base address        ldu     fio_dba,y        ldx     fifo_us1,u      offset to GW data        addr    U,X             U + X -> X*        lda     uicnt+1        cmpa    #WZLCSZ        DCFLEN        bne     81f*        pshs    x,u        tfr     x,u            U points to fifo_us1        lda     #2             wzrdev        ldb     #S_SPCL        jsr     fio_msg        this read the device registers back        puls    x,u        lda     #WZLCSZ        DCFLEN02      pshs    a        ldb     0,x+        pshs    x,y,u        jsr     passc        puls    x,y,u          uistrt / uicnt        puls    a        bmi     03f        deca        bne     02b*03      puls    x,y,u,pc** write configuration data, B=minor*wzwrd   equ     *        pshs    x,y,u        ldy     #NWP0           get parameter base address        ldu     fio_dba,y        ldx     fifo_us1,u        addr    U,X             U + X -> X*        lda     uicnt+1         check 'specific size'        cmpa    #WZLCSZ         DCFLEN        blo     81f        lda     #WZLCSZ*        pshs    x               us1 address02      pshs    a,x,y,u        jsr     cpass        puls    a,x,y,u        bmi     03f        stb     0,x+        deca        bne     02b*03      ldb     #S_SPCL        lda     #0        puls    u               make U point to us1 area        jsr     fio_msg         tell IOP to put it in device*        puls    x,y,u,pcwzspc   equ     *        tfr     x,y        sty     -2,s            test Y        bne     doget* doset        ldy     #NWP0           get parameter base address        lda     usarg0+1        ldu     fio_dba,y        ldx     fifo_us1,u        leax    32,x        tfr     x,u             special area* U= device info        ldb     #S_SPCL        jsr     fio_msg         make IOP do it        rtsdoget   equ     *        pshs    x,y,u*81      lda     #EBARG        sta     uerror        puls    x,y,u,pc        else        data        nop        endif        end