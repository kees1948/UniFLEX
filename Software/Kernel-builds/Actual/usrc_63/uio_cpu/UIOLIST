CPU09UIO   Intelligent I/O Proce     18:04:38  Jan 23, 2026   Page    1Hardware   Definitions                                                                                                       opt    lisCPU09UIO   Intelligent I/O Proce     18:04:39  Jan 23, 2026   Page    2IOP        Memory Layout                                                 *                     * Basic Memory Layout                     *               0100  RAMorg    equ    $0100     28K of RAM - Thru $6FFF               6FFF  RAMend    equ    $6FFF               7000  RAMscratch equ   $7000     4K of scratchpad RAM               7F00  RAMscrend equ    $7F00               7FFF  ROMstack  equ    $7FFF     High end of ROM Stack               E000  ROMLOorg  equ    $E000     8K of ROM - $E000-$FFFF               C000  DEBUGROM  equ    $C000     8K of Debug ROM $C000-$DFFF               FFF0  CPUtraps  equ    $FFF0     CPU Trap Vectors                                          * clock hardware               8070  CLOCK     equ    $8070     hardware clock, status and control               8071  CLOCKI    equ    $8071     interrupt resetCPU09UIO   Intelligent I/O Proce     18:04:39  Jan 23, 2026   Page    3Task       Structure                                                     *                     * Task Table                     *                       0000                         org    0                                          * struct task                                    008A  USTSIZ    equ    138       User Stack Size (big enough??)                     *  0000               tslink    rmb    2         list link of running tasks  0002               tsslnk    rmb    2         list link of sleeping tasks  0004               tsstat    rmb    1         * see below *  0005               tsprir    rmb    1         priority - negative is low  0006               tsevnt    rmb    2         event task is waiting on  0008               tssgnl    rmb    1         Signal waiting for task                     *  0009               tscmd     rmb    1         Saved mailbox command  000A               tsseq     rmb    2         Saved message sequence #  000C               tstval    rmb    1         Saved transaction value  000D               tsdev     rmb    2         Terminal task is servicing  000F               tsdtix    rmb    1         device table entry index  0010               tsagin    rmb    2         Task re-entry pointer                     *  0012               usp       rmb    2         Saved User Stack Pointer  0014               umark0    rmb    2         Stack Frame Markers  0016               umark1    rmb    2  0018                         rmb    USTSIZ    space for per/process stack                                    00A2  TSKSIZ    equ    *         task structure size                     * stat codes                                    0001  TRUN      equ    1         running               0002  TSLEEP    equ    2         sleep with high priority               0003  TWAIT     equ    3         sleep with low priority               0004  TFREE     equ    4         task is free (uncommitted)               0005  TSYS      equ    5         system taskCPU09UIO   Intelligent I/O Proce     18:04:39  Jan 23, 2026   Page    4Variable   Space                                                           0100                         org    RAMorg                       0100               sys_vars  rmb    0         -- start of system variables                                          * Configuration "constants"  0100               DB_iflg   rmb    1         Debug terminal initialized  0101               DB_cntrl  rmb    2         Debug control flags                     *  0103               runlst    rmb    2         Pointer to active tasks  0105               slplst    rmb    4         Pointer to waiting tasks  0109               utask     rmb    2         Currently executing task  010B               jobpri    rmb    1         Current job priority (for scheduling)  010C               chproc    rmb    1         Set if must switch users of CPU (reschedule)  010D               cfreel    rmb    2         Pointer to first free Clist buffer  010F               cbufct    rmb    1         Count of Clist buffers in use  0110               lcbuf     rmb    1         Limit on Clist buffers  0111               idle      rmb    1         idle loop flag for scheduler  0112               SI_Q      rmb    6*MAX_TI  Max Terminal Interrupts  014E               SI_Q_ptr  rmb    2         current Q pointer  0150               FIO_lock  rmb    1         FIO in use lock                     *  0151               int_buf   rmb    2*7       Current Message in (1+2+1+2+1)  015F               int_ptr   rmb    2         Message in pointer  0161               clock_tick rmb   1         Clock tick counter                                                               * Pointers to system tables - configuration dependent  0162               TTYTABS   rmb    2         Terminal tables  0164               tsktab    rmb    2         Task Control Tables  0166               tskend    rmb    2         End of task table  0168               dev_tab   rmb    DEV_SIZE*MAX_DEV system configuration table***  Undefined symbol***  Undefined in pass 1                     *  0168               SYS_TABS  rmb    0         Start of dynamic system tables                                    6FFF  end_vars  equ    RAMend    End of System VariablesCPU09UIO   Intelligent I/O Proce     18:04:40  Jan 23, 2026   Page    5FIO in Dual Port RAM                                                                          *                     * is now performed by CY7C130 dual port RAM where (1024 * 8)                     * the RAM size is limited to the (upper) 256 bytes, which                     * contains the Interrupt handshake locations                     *                     *                       0000                         org    $0000     absolute addressed                                          ************************************************************                     * the first 32 bytes of a fifo/DPR area are the same                     * for ALL applications                     ************************************************************  0000               cpu_fio   rmb    1         Command code  0001               cpu_fio1  rmb    2         Task ID/sequence  0003               cpu_fio2  rmb    1         Message specific data  0004               cpu_fio3  rmb    2         Device designator  0006               cpu_fio4  rmb    2         UIO  0008               cpu_fio5  rmb    1         Device table index                     ************************************************************  0009               fio_cpu   rmb    1         Response code  000A               fio_cpu1  rmb    2         Task ID /sequence  000C               fio_cpu2  rmb    1         Transaction specific value  000D               fio_cpu3  rmb    2         --  000F               fio_cpu4  rmb    2         UIO  0011               fio_cpu5  rmb    1         --                     ************************************************************                     *  0012               fifo_cnt  rmb    2         Count of data in FIFO  0014               fifo_get  rmb    2         retrieval ponter  0016               fifo_put  rmb    2         storage pointer                     *                     * these values are initialized by the IO CPU                     *  0018               fifo_us0  rmb    2         FIFO offset to application data                     *  001A               fifo_us1  rmb    2         FIFO offset to user specific area2  001C               fifo_us2  rmb    2         FIFO offset to user specific area2  001E               fifo_us3  rmb    2         FIFO offset to user specific area3                     *  0020                         rmb    32-(*-cpu_fio) ** Filler **                     * end of defined area                                          ************************************************************  0020               fifo      rmb    1                     * the size of the fifo is defined in the parameter block                     ************************************************************                                          ************************************************************                     * the top 4 locations are also fixed and shared on all applications                     ************************************************************CPU09UIO   Intelligent I/O Proce     18:04:40  Jan 23, 2026   Page    6FIO in Dual Port RAM                                  0021               DEV2CPU   rmb    1         debug data from IOP/GPP  0022               CPU2DEV   rmb    1         debug data to IOP/GPP                     * should end up at the two top locations in the DUALPORT RAM  0023               fio_cpuF  rmb    1         INT + non-zero   contains info AND set CPU IRQ when written  0024               cpu_fioF  rmb    1         INT + non-zero   contains info AND set FIO IRQ when written                     **************************************************************                                          *                     * FIO Task Priority                     *   -- Set to make task uninterruptable while                     *   -- actually using the FIO                     *               000F  FIOPRI    set    15                                          *                     * FIO Control structures                     *                                          * Transaction slots                                                               *                     * IOP ROM Version #                     *               0020  ROM_VERSION equ  $20       Major/Minor Version of IOP ROM                                          *                     * generic and specific transaction codes for use with fio_han                     * these are for IOP                     *                                          *                     * Error codes                     *               0080  REJECT    equ    %10000000 Error/Reject bit in command response               0081  E_BADCMD  equ    REJECT+$01 Illegal command               0082  E_SYSBSY  equ    REJECT+$02 IOP saturated               0083  E_NTOPEN  equ    REJECT+$03 Selected device not open               0084  E_BADDEV  equ    REJECT+$04 Illegal device # (=3)               0085  E_DEVBSY  equ    REJECT+$05 Device is already open (exclusieve)               0086  E_IOERR   equ    REJECT+$06 Some sort of IO error               00BE  E_INTRPT  equ    REJECT+$3E Terminal interrupt (send by IOP to UniFLEX)               00BF  E_ABORT   set    REJECT+$3F Transaction aborted by UniFLEX (not sent by IOP)               00C0  E_SOCKET  equ    REJECT+$40 Socket error,                                          *                     * Request codes (from Main CPU) is index in DEV_XXXX table at IOP                     *               0008  O_OPEN    equ    $08       Open device               0010  O_CLOSE   equ    $10       Close device               0018  O_RQWR    equ    $18       Request write               0020  O_WRITE   equ    $20       Write data via fifo to IOPCPU09UIO   Intelligent I/O Proce     18:04:40  Jan 23, 2026   Page    7FIO in Dual Port RAM                                               0028  O_RQRD    equ    $28       Request read data               0030  O_READ    equ    $30       Read data for via fifo from IOP               0038  O_INTRPT  set    $38       Interrupt all tasks on a terminal               0040  O_WR1C    equ    $40       Write single character               0048  O_TTYS    equ    $48       TTY Set               0050  O_TTYG    equ    $50       TTY Get                                    0058  O_PGETD   equ    $58       Read baudrate settings               0060  O_PSETD   equ    $60       Write baudrate settings                                          *                     * Normal responses                     * error is with bit 7 set, A contains error code                     *               000F  R_RESET   equ    $0F       System reset & functioning               0001  R_OPEN    equ    $01       Device open successful               0002  R_CLOSE   equ    $02       Device close successful               0003  R_REQOK   equ    $03       Write request now granted               0004  R_WRITE   equ    $04       Write data complete               0005  R_RDOK    equ    $05       Read data now available               0006  R_READ    equ    $06       Read data in FIFO & no more data is available               0007  R_INTRPT  set    $07       Interrupt complete               0008  R_WR1C    equ    $08       Write single character               0009  R_RD1C    equ    $09       Single character available               000B  R_PDATA   equ    $0B       port data transaction succes               000C  R_READM   equ    $0C       Read data in fifo, more data waiting               000D  R_TTY     equ    $0D       TTYSET/GET complete               000E  R_CLOCK   equ    $0E       Interval Timer Tick                                          CPU09UIO   Intelligent I/O Proce     18:04:41  Jan 23, 2026   Page    8CPU        Vectors                                                         0025                         abs                       FFF0                         org    CPUtraps                       FFF0 E0BB                    fdb    rom_trap  Unused  FFF2 E0B4                    fdb    rom_swi3  SWI3  FFF4 E0AD                    fdb    rom_swi2  SWI2  FFF6 E0A0                    fdb    rom_firq  FIRQ  FFF8 E069                    fdb    irq_han   IRQ  FFFA E0A7                    fdb    rom_swi   SWI  FFFC E09A                    fdb    rom_nmi   NMI  FFFE E075                    fdb    rom_init  Reset                     CPU09UIO   Intelligent I/O Proce     18:04:41  Jan 23, 2026   Page    9System     RESET Code                                                                         *                     * this declaration makes it possible to address                     * NUM_TSK, NUM_TRM etc directly                     *                     *                     * starting device minor for IOP serial devices                     *                     * on the CPU side, serial devices may take up                     * from tty00 up to tty08                     *               0009  IOPTDMIN  equ    9         IOP tty lowest minor               00E0  CFGDAT    equ    $00E0     place in DPR where info is passed                       00E0                         org    CFGDAT  00E0               NUM_TSK   rmb    1  00E1               NUM_CL    rmb    1  00E2               NUM_TRM   rmb    1  00E3               NUM_PPR   rmb    1  00E4               NUM_NEC   rmb    1                                          *                     * the normal declaraction for this device                     *  E000                         org    ROMLOorg                       E000 0D 55 49 4F   DBmsg00   fcc    $d,'UIO ROM :260101',0  E011 0D 53 79 73   DBmsg01   fcc    $d,'System Initialization Complete',0  E031 0D 43 50 55   DBmsg02   fcc    $d,'CPU RESET Complete',0  E045 0D 0D 53 79   CPU_down  fcc    $d,$d,'System CPU not functioning',0                                                         E062  fio_fsz   equ    *               E064  fio_dsz   equ    *+2               E066  max_trn   equ    *+4                     *                     * share specific DUAL PORT RAM device initialization                     * between UniFLEX kernel and UIO CPU                     *  E062 0080                    fdb    128       fio_fsz FIFO SIZE  E064 0100                    fdb    256       fio_dsz DEVICE SIZE  E066 00                      fcb    0         fio_mxtrn MAX_TRANSACTIONS  E067 0000                    fdb    0         OS side interrupt routine                     *                                          *                     * IRQ handler                     *               E069  irq_han   equ    *  E069 BD   E366               jsr    IRQ_han   do actual handler                     *                     * common return for all interruptsCPU09UIO   Intelligent I/O Proce     18:04:41  Jan 23, 2026   Page   10System     RESET Code                                                    *  E06C 7D   010C     intret    tst    chproc    change process?  E06F 27   03                 beq    01f  E071 BD   E427               jsr    change    change process  E074 3B            01        rti                                                               *                     * System RESET code, interrupts disabled                     *  E075 10CE 7FFF     rom_init  lds    #ROMstack initialize stack pointer  E079                         ldmd   3                       E07C 8E   0000               ldx    #0        clear all of RAM, including FIFO  E07F CC   0000               ldd    #0  E082 ED   81       10        std    ,x++  E084 8C   6FFF               cmpx   #end_vars  E087 25   F9                 blo    10b                      >E089 17   0050     20        lbsr   stbinit   go initialize system memory                       E08C 10FE 0164     30        lds    tsktab  E090 32   E9 00A2            leas   TSKSIZ,s  Task 0 Stack  E094 17   010B               lbsr   fio_reset                                          *                     * Initialization complete - Start executing commands                     *  E097               fio_start                       E097 7E   E42D     10        jmp    rsched                     CPU09UIO   Intelligent I/O Proce     18:04:41  Jan 23, 2026   Page   11ROM        Interrupt Fielders                                              E09A 8D   26       rom_nmi   bsr    rom_int  E09C 4E 4D 49 00             fcc    'NMI',0  E0A0 8D   20       rom_firq  bsr    rom_int  E0A2 46 49 52 51             fcc    'FIRQ',0  E0A7 8D   19       rom_swi   bsr    rom_int  E0A9 53 57 49 00             fcc    'SWI',0  E0AD 8D   13       rom_swi2  bsr    rom_int  E0AF 53 57 49 32             fcc    'SWI2',0  E0B4 8D   0C       rom_swi3  bsr    rom_int  E0B6 53 57 49 33             fcc    'SWI3',0  E0BB 8D   05       rom_trap  bsr    rom_int  E0BD 54 52 41 50             fcc    'TRAP',0                       E0C2 8E   E0CF     rom_int   ldx    #ROM_ERR  E0C5 BD   E562               jsr    DB_pdata  E0C8 35   10                 puls   x  E0CA BD   E562               jsr    DB_pdata  E0CD 20   FE       rom_bad   bra    *                     *  E0CF 0D 52 4F 4D   ROM_ERR   fcc    $d,'ROM Error: ',0CPU09UIO   Intelligent I/O Proce     18:04:41  Jan 23, 2026   Page   12Table      Initialization                                                                                          *                     * stbinit - Initialize System Memory Tables                     * >E0DC 17   000D     stbinit   lbsr   set_tables go figure out configuration, tables, etc                                          * Initialize Terminal Interrupt Queue  E0DF 8E   0112     15        ldx    #SI_Q     set queue empty  E0E2 BF   014E               stx    SI_Q_ptr  E0E5 8E   0151               ldx    #int_buf  reset message in pointer  E0E8 BF   015F               stx    int_ptr                     * further table setup                                            E0EB 39                      rts                                          *                     * Set up system tables                     *  E0EC               set_tables                                          * Compute configuration                     *  E0EC B6   E066               lda    max_trn   reserve for system tasks  E0EF 8B   04                 adda   #4  E0F1 97   E0                 sta    NUM_TSK                     *                                                               * -- Task table  E0F3 86   A2                 lda    #TSKSIZ  E0F5 D6   E0                 ldb    NUM_TSK  E0F7 3D                      mul  E0F8 FF   0164               stu    tsktab >E0FB 17   0010               lbsr   sto_chk   check for system table space overflow  E0FE 25   05                 bcs    40f       jump if it happens  E100 FF   0166               stu    tskend                     *  E103 20   08                 bra    60f                                          * -- System table space has overflowed!                     * -- Try adjusting some parameters to get it under control  E105               40  E105 9E   18                 ldx    fifo_us0  pointer                       E107 7E   E075               jmp    rom_init  ... what else can I do???  E10A 16   FF7F     50        lbra   30b       go try it all again                     *-- Initialize devices  E10D               60                     * -- All done  E10D 39            90        rtsCPU09UIO   Intelligent I/O Proce     18:04:42  Jan 23, 2026   Page   13Table      Initialization                                                *                                          *                     * Allocate some system table space                     *   D - Space being consumed                     *   U - Current end of table space                     *   jsr sto_chk (System Table Overflow check)                     *   <CS> if overflow                     *  E10E 33   CB       sto_chk   leau   d,u       compute new end pointer  E110 1183 6FFF               cmpu   #end_vars overflow?  E114 22   03                 bhi    10f       yes - return error  E116 1C   FE                 clc              no         - return OK  E118 39                      rts  E119 1A   01       10        sec              ..         bad owies  E11B 39                      rts                                          *                     * tskinit - Initialize all tasks                     *  E11C 8E   0164     tskinit   ldx    #tsktab  E11F BF   0109               stx    utask  E122 D6   E0                 ldb    NUM_TSK   # tasks in system  E124 34   04                 pshs   b  E126 10BE 0164               ldy    tsktab    task 1  E12A 31   A9 00A2            leay   TSKSIZ,y  E12E               10  E12E 86   04       11        lda    #TFREE    mark all tasks free  E130 BC   0164               cmpx   tsktab    is this the system task?  E133 26   02                 bne    15f  E135 86   05                 lda    #TSYS     the system task is never free  E137 A7   04       15        sta    tsstat,x  E139 86   FF                 lda    #$FF      not associated with a terminal  E13B A7   0D                 sta    tsdev,x  E13D A7   0E                 sta    tsdev+1,x  E13F 33   89 00A2            leau   TSKSIZ,x  initialize stack  E143 CC   E2DE               ldd    #IO_han  E146 34   20                 pshs   y  E148 AC   E1                 cmpx   ,s++      task 1?  E14A 26   03                 bne    20f       no - normal I/O handling task  E14C CC   E3C2               ldd    #SI_HAN   yes - special signal interrupt handling task  E14F 36   06       20        pshu   d  E151 EF   88 12              stu    usp,x  E154 EF   88 14              stu    umark0,x  E157 30   89 00A2            leax   TSKSIZ,x  E15B 6A   E4                 dec    0,s       done?  E15D 26   CF                 bne    10b  E15F 32   61                 leas   1,s       clean up stack  E161 CC   0000               ldd    #0        nothing running or sleeping  E164 FD   0103               std    runlst  E167 FD   0105               std    slplst  E16A FD   0107               std    slplst+tsslnkCPU09UIO   Intelligent I/O Proce     18:04:42  Jan 23, 2026   Page   14Table      Initialization                             E16D 30   A4                 leax   0,y       start interrupt handling task  E16F BD   E4D3               jsr    makrdy  E172 39                      rtsCPU09UIO   Intelligent I/O Proce     18:04:42  Jan 23, 2026   Page   15IOP        Configuration                                                                      *                     * define which type of boards are present                     *               E173  mod_tbl   equ    *  E173 E182 E179               fdb    DEV_UIO,UIO_name  E177 0000                    fdb    0                     *  E179 43 50 55 30   UIO_name  fcc    'CPU09UIO',0                                          *                     * UIO Device table                     *  E182               DEV_UIO  E182 E5BF                    fdb    bad_cmd   0 -  E184 E5BF                    fdb    open_uio  1 -  E186 E5BF                    fdb    close_uio 2 -  E188 E5BF                    fdb    req_write 3 -  E18A E5BF                    fdb    write_data 4 -  E18C E5BF                    fdb    req_read  5 -  E18E E5BF                    fdb    read_data 6 -  E190 E5BF                    fdb    bad_cmd   7 -  E192 E5BF                    fdb    ttyset    8 -  E194 E5BF                    fdb    ttyget    9 -  E196 E5BF                    fdb    bad_cmd   A -  E198 E5BF                    fdb    bad_cmd   B -  E19A E5BF                    fdb    bad_cmd   C -  E19C E5BF                    fdb    bad_cmd   D -  E19E E5BF                    fdb    bad_cmd   E -  E1A0 E5BF                    fdb    bad_cmd   F -                     *                     * end of FIO command list                     *               0010  MAX_FCMD  equ    (*-DEV_UIO)/2                                          *CPU09UIO   Intelligent I/O Proce     18:04:42  Jan 23, 2026   Page   16FIO        Simulation Routines                                                                *                     * Reset CPU-IOP Interface                     * it is assumed that the FIO (DPR) sits at $0000                     *  E1A2               fio_reset                     * when here, all storage locations have been erased already                     *  E1A2 8E   0000               ldx    #0  E1A5 9F   14                 stx    fifo_get  set Q pointers  E1A7 9F   16                 stx    fifo_put  E1A9 8E   00E0               ldx    #CFGDAT  E1AC 9F   18                 stx    fifo_us0  so that kernel CPU can see it  E1AE BE   E064               ldx    fio_dsz  E1B1 30   1E                 leax   -2,x      one from top  E1B3 CE   0400               ldu    #1024     -- Reset Time-Out value                     *  E1B6 C6   FF       fio_wait  ldb    #255      Spin counter                     *  E1B8               00  E1B8 6D   84                 tst    0,x       fio_cpuF  E1BA 27   0D                 beq    10f                     *  E1BC 5A                      decb  E1BD 26   F9                 bne    00b       jump back if not ready  E1BF 33   5F                 leau   -1,u  E1C1 1183 0000               cmpu   #0  E1C5 26   EF                 bne    fio_wait  E1C7 20   D9                 bra    fio_reset wait 'forever'                     * reset OK  E1C9 39            10        rtsCPU09UIO   Intelligent I/O Proce     18:04:43  Jan 23, 2026   Page   17FIO        Simulation Routines                                                                *                     * fio_msg - Send a message via the FIO Mailbox                     * it is assumed that the FIO (DPR) sits at $0000                     *   B - Message code to send (one byte)                     *   fio_cpu1..3 already set up                     *  E1CA 34   54       fio_msg   pshs   b,x,u     save register  E1CC FE   E064               ldu    fio_dsz  E1CF 33   5E                 leau   -2,u      one off top  E1D1 D7   09                 stb    fio_cpu   set up mailbox value                       E1D3 86   FF       5         lda    #$FF      tell CPU mailbox full  E1D5 A7   C4                 sta    0,u       fio_cpuF  E1D7 8E   FFFF     05        ldx    #$FFFF    time-out counter                     *  E1DA A6   C4       10        lda    0,u       fio_cpuF   wait till value consumed  E1DC 27   06                 beq    20f       jump if consumed                     *  E1DE 30   1F                 leax   -1,x      time-out yet?  E1E0 26   F8                 bne    10b                     *  E1E2 20   F3                 bra    05b       try again                     *  E1E4 35   D4       20        puls   b,x,u,pc                     *                                          *                     * fio_response - Return a response code/sequence #                     * it is assumed that the FIO (DPR) sits at $0000                     *    X = utask,                     *    B - Response code                     *    A - Transaction specific value                     *  E1E6 34   16       fio_response pshs d,x  E1E8 8D   18                 bsr    FIO_get   access FIO  E1EA BE   0109               ldx    utask     task ID  E1ED EC   0A                 ldd    tsseq,x  E1EF DD   0A                 std    fio_cpu1  E1F1 EC   0D                 ldd    tsdev,x   device info  E1F3 DD   0D                 std    fio_cpu3  E1F5 A6   E4                 lda    0,s       get transaction specific value  E1F7 97   0C                 sta    fio_cpu2  E1F9 E6   61                 ldb    1,s       is RESPONSE code >E1FB BD   E1CA               jsr    fio_msg  E1FE 8D   17                 bsr    FIO_rel   release FIO  E200 35   96                 puls   d,x,pc    return                                          *                     * FIO_get - Get access to FIO device                     * -- Sleep till available                     *CPU09UIO   Intelligent I/O Proce     18:04:43  Jan 23, 2026   Page   18FIO        Simulation Routines                        E202 34   76       FIO_get   pshs   d,x,y,u   save registers  E204 108E 0150     10        ldy    #FIO_lock is the device locked  E208 6D   A4                 tst    0,y  E20A 27   07                 beq    20f       no - go get it                     *  E20C C6   0F                 ldb    #FIOPRI   waiting for the FIO  E20E BD   E50D               jsr    sleep  E211 20   F1                 bra    10b       try again                     *  E213 6C   A4       20        inc    0,y       mark in use  E215 35   F6                 puls   d,x,y,u,pc return                                          *                     * FIO_rel - Release access to FIO                     *  E217 34   76       FIO_rel   pshs   d,x,y,u  E219 108E 0150               ldy    #FIO_lock  E21D 6F   A4                 clr    0,y  E21F BD   E4E9               jsr    wakeup  E222 35   F6                 puls   d,x,y,u,pc return                                          *                     * FIFO_get - Fetch character from FIFO                     *   B - Character fetched                     *  E224 34   04       FIFOgeta  pshs   b  E226 8D   05                 bsr    FIFO_get  E228 35   02                 puls   a  E22A 1E   89                 exg    a,b  E22C 39                      rts                     *  E22D 34   12       FIFO_get  pshs   a,x  E22F DC   12                 ldd    fifo_cnt  any data?  E231 27   15                 beq    99f       no - exit                     *  E233                         decd   yes       - adjust count  E235 DD   12                 std    fifo_cnt  E237 9E   14                 ldx    fifo_get  get consumer pointer  E239 E6   88 20              ldb    fifo,x    fetch byte  E23C 30   01                 leax   1,x       bump pointer  E23E BC   E062               cmpx   fio_fsz   end of fifo?  E241 26   03                 bne    10f                     *  E243 8E   0000               ldx    #0        reset pointer                     *  E246 9F   14       10        stx    fifo_get                     *  E248 35   92       99        puls   a,x,pc                                          *                     * FIFO_put - Place character into FIFO                     *   B - Character fetchedCPU09UIO   Intelligent I/O Proce     18:04:43  Jan 23, 2026   Page   19FIO        Simulation Routines                                           *  E24A 34   04       FIFOputa  pshs   b  E24C 1F   89                 tfr    a,b  E24E 8D   02                 bsr    FIFO_put  E250 35   84                 puls   b,pc                     *  E252 34   16       FIFO_put  pshs   d,x  E254 9E   16                 ldx    fifo_put  get consumer pointer  E256 E7   88 20              stb    fifo,x    store byte  E259 30   01                 leax   1,x       bump pointer  E25B BC   E062               cmpx   fio_fsz   end of FIFO?  E25E 26   03                 bne    10f                     *  E260 8E   0000               ldx    #0        reset pointer  E263 9F   16       10        stx    fifo_put                     *  E265 DC   12                 ldd    fifo_cnt  E267                         incd  E269 DD   12                 std    fifo_cnt  E26B 35   96       99        puls   d,x,pcCPU09UIO   Intelligent I/O Proce     18:04:43  Jan 23, 2026   Page   20FIO        FIO IRQ code                                                                       *                     * FIO interrupt handler, called when IRQ was set (interrupt context)                     * for regular NWP and IOP purpose                     *  E26D BE   015F     fio_irq   ldx    int_ptr   input message pointer  E270 96   00                 lda    cpu_fio   move REQUEST  E272 A7   80                 sta    ,x+  E274 DC   01                 ldd    cpu_fio1  sequence # TASK ID  E276 ED   81                 std    ,x++  E278 96   03                 lda    cpu_fio2  specific DATA  E27A A7   80                 sta    ,x+  E27C DC   04                 ldd    cpu_fio3  device major/minor  E27E ED   81                 std    ,x++  E280 96   08                 lda    cpu_fio5  E282 A7   80                 sta    0,x+                     *                     * X[0]=cmd,X[1][2]=task ID,X[3]=data, X[4][5]=device, X[6]=devtab                     *  E284 FE   E064               ldu    fio_dsz  E287 33   5F                 leau   -1,u  E289 6F   C4                 clr    0,u       cpu_fioF indicate message consumed                     *  E28B BF   015F               stx    int_ptr   update pointer  E28E 108E 0151               ldy    #int_buf  get message from buffer  E292 A6   A4                 lda    0,y       -- Send interrupt command?  E294 81   38                 cmpa   #O_INTRPT  E296 26   0D                 bne    30f                     *                     * special case OOB signal                     *  E298 10BF 015F               sty    int_ptr   reset pointer  E29C E6   23                 ldb    3,y       signal  E29E AE   24                 ldx    4,y       DEVICE/SOCK reference                     *  E2A0 BD   E5C1               jsr    sdev_sig  send device signal  E2A3 20   38                 bra    fiointe   exit                     *                     * normal command                     * acquire free task slot                     *  E2A5 8E   0164     30        ldx    #tsktab   search for an available task  E2A8 D6   E0                 ldb    NUM_TSK   Number of tasks in system                     *  E2AA A6   04       32        lda    tsstat,x  E2AC 81   04                 cmpa   #TFREE    looking for a "free" task  E2AE 27   0E                 beq    40f                     *  E2B0 30   89 00A2            leax   TSKSIZ,x  E2B4 5A                      decb  E2B5 26   F3                 bne    32b                     *CPU09UIO   Intelligent I/O Proce     18:04:44  Jan 23, 2026   Page   21FIO        FIO IRQ code                               E2B7 C6   82                 ldb    #E_SYSBSY can't process - IOP saturated!  E2B9 BD   E1CA               jsr    fio_msg  E2BC 20   1F                 bra    fiointe   exit                     *                     * X[0]=cmd,X[1][2]=task ID,X[3]=data, X[4][5]=device, X[6]=device table                     * move data over into task struct                     *  E2BE 108E 0151     40        ldy    #int_buf  get message from buffer  E2C2 10BF 015F               sty    int_ptr   reset pointer  E2C6 E6   A0                 ldb    ,y+       command byte  REQUEST  E2C8 E7   09                 stb    tscmd,x   save for task  E2CA EC   A1                 ldd    ,y++      sequence #    task ID  E2CC ED   0A                 std    tsseq,x  E2CE E6   A0                 ldb    ,y+       command specific DATA  E2D0 E7   0C                 stb    tstval,x  E2D2 EC   A1                 ldd    ,y++      associate with terminal major/minor  E2D4 ED   0D                 std    tsdev,x  E2D6 A6   A0                 lda    ,y+  E2D8 A7   0F                 sta    tsdtix,x  device table index  E2DA BD   E4D3               jsr    makrdy    make task ready to run                     *  E2DD 39            fiointe   rts              exitCPU09UIO   Intelligent I/O Proce     18:04:44  Jan 23, 2026   Page   22IO         Command Handler                                               *                     *                     * IO_han - I/O Command Handler                     *                     *   This routine comprises the main processing loop                     * for each task in the system.  Whenever an I/O command                     * is detected (via the message interrupt), a task will                     * be scheduled to process it.  This is that task.                     *   The command is saved in the "tscmd" field of the                     * task control block.                     *  E2DE               IO_han                     *                     * we execute the task belonging to the transaction                     *  E2DE                         clri  E2E0 BE   0109               ldx    utask     get task control block address  E2E3 A6   09                 lda    tscmd,x   get I/O command  E2E5 E6   0F                 ldb    tsdtix,x  get device table selector                     *                     * The command byte is shifted and used as an index                     * in a DEV_XXXX tab, max 32 commands allowed                     *  E2E7 44                      lsra             isolate    command  E2E8 44                      lsra  E2E9 44                      lsra                     *  E2EA C1   00                 cmpb   #MAX_DEV  invalid device?***  Undefined symbol  E2EC 25   04                 blo    00f  E2EE C6   84                 ldb    #E_BADDEV  E2F0 20   53                 bra    20f                     *  E2F2 81   10       00        cmpa   #MAX_FCMD max. fifo commands  E2F4 25   04                 blo    01f  E2F6 C6   81                 ldb    #E_BADCMD  E2F8 20   4B                 bra    20f                     *                     * build 16 bit index in table                     *  E2FA 48            01        lsla             --   word index on command  E2FB 34   10                 pshs   x         TASK info  E2FD 34   02                 pshs   a  E2FF 8E   0168               ldx    #dev_tab  E302 86   06                 lda    #DEV_SIZE  E304 3D                      mul  E305 30   8B                 leax   d,x       right table selected  E307 AE   02                 ldx    dev_type,x get handler table address  E309 35   02                 puls   a  E30B 10AE 86                 ldy    a,x       get processor address  E30E 35   10                 puls   x  E310 34   20                 pshs   y         can be changed on stack..CPU09UIO   Intelligent I/O Proce     18:04:44  Jan 23, 2026   Page   23IO         Command Handler                                               *                     * Y=function code address, X = task                     *  E312 10AE 88 10              ldy    tsagin,x  if 0, d nothing  E316 27   0B                 beq    05f       else it is target ponter  E318 10AF E4                 sty    0,s       code asks for rerun, overwrite  E31B 108E 0000               ldy    #0  E31F 10AF 88 10              sty    tsagin,x  reset pointer                     *                     * TOS now holds correct execution address                     *  E323 35   20       05        puls   y         change address  E325 4F                      clra                     *  E326 8E   E348               ldx    #IO_end   interrupt handler address  E329 34   10                 pshs   x  E32B BE   0109               ldx    utask     task pointer  E32E 10EF 88 16              sts    umark1,x  E332 EE   0D                 ldu    tsdev,x   get sock reference                     *                     * CALL HANDLER: X=utask, Y=handler address, U=device reference                     * can be maj/min or wzsock address                     *  E334 AD   A4                 jsr    0,y       perform operation & return status  E336 32   62                 leas   2,s       clean up stack                     *                     * on return, Y= flag. -1 is resched, else end task                     * B = status , A = danta, X,U are lost                     *  E338 BE   0109               ldx    utask     restore task pointer  E33B 108C FFFF               cmpy   #$ffff  E33F 26   04                 bne    20f                     * task is NOT done yet, don't stop it! re-schedule  E341                         seti   set       interrupt mask  E343 20   18                 bra    91f       just escape (and come back)                     *                     * A=transaction value, B=response code, U=device reference                     * X = task pointer                     * in fio_response the task ID is added as sequence reference                     * SEND the response to the host CPU                     *                     *  E345 BD   E1E6     20        jsr    fio_response                     *                     * task is done                     *  E348               IO_end    seti   mask      interrupts  E34A BE   0109               ldx    utask     restore task control block address  E34D A7   0C                 sta    tstval,x  remember transaction value sent  E34F E7   09                 stb    tscmd,x   and command response  E351 86   04                 lda    #TFREE    mark task "terminated & free"  E353 A7   04                 sta    tsstat,xCPU09UIO   Intelligent I/O Proce     18:04:44  Jan 23, 2026   Page   24IO         Command Handler                            E355 86   FF                 lda    #$FF      disassociate from any terminal  E357 A7   0D                 sta    tsdev,x  E359 A7   0E                 sta    tsdev+1,x  E35B 6F   08                 clr    tssgnl,x  no waiting signals                     *                     * exit here to rescheduling                     *  E35D BD   E42D     91        jsr    rsched    run other tasks  E360 16   FF7B               lbra   IO_han                                          *                     * not implemented                     *  E363 C6   81       bad_cmd   ldb    #E_BADCMD error code***  Multiply defined symbol***  Phasing error detected  E365 39                      rtsCPU09UIO   Intelligent I/O Proce     18:04:45  Jan 23, 2026   Page   25Interrupt  Processing                                                                         *                     * This routine handles all IRQ interrupts                     *                     *  E366               IRQ_han                     *  E366 CE   0168     00        ldu    #dev_tab  scan devices  E369 CC   0000               ldd    #0        start with device 0                     *  E36C AE   C4       10        ldx    dev_addr,u get device address  E36E 27   0A                 beq    20f       jump if none there                     *  E370 10AE 42                 ldy    dev_type,u get device type  E373 AD   B8 20    15        jsr    [D_inthan,y] call interrupt poller/handler >E376 1025 0017               lbcs   99f       exit if interrupt serviced                     *  E37A C3   0001     20        addd   #1        next device  E37D 33   46                 leau   DEV_SIZE,u  E37F 1083 0000               cmpd   #MAX_DEV  any more devices?***  Undefined symbol  E383 25   E7                 blo    10b                                          *                     * Check for FIO Mailbox interrupt                     *  E385 FE   E064               ldu    fio_dsz  E388 33   5F                 leau   -1,u      top location  E38A A6   C4                 lda    0,u       cpu_fioF   see if mailbox interrupt  E38C 27   03                 beq    99f       no - move on  E38E BD   E26D               jsr    fio_irq                                          *         lbsr    DB_main                     *  E391 39            99        rts              return from interrupt                     *CPU09UIO   Intelligent I/O Proce     18:04:45  Jan 23, 2026   Page   26Interrupt  All Tasks                                                                          *                     * Interrupt all tasks associated with a given device                     *   D - Device #, XL = SIG                     *   jsr int_all                     * Note: The current task is skipped, along with                     * the system and the interrupt handler task (1).                     *  E392 34   36       int_all   pshs   d,x,y  E394 D6   E0                 ldb    NUM_TSK  E396 C0   02                 subb   #2  E398 34   04                 pshs   b  E39A BE   0164               ldx    tsktab  E39D 30   89 0144            leax   2*TSKSIZ,x                     *  E3A1 EC   61       10        ldd    1,s  E3A3 10A3 0D                 cmpd   tsdev,x   is this guy associated with the device?  E3A6 26   0E                 bne    20f                     *  E3A8 BC   0109               cmpx   utask     make sure I don't get blown away  E3AB 27   09                 beq    20f                     *  E3AD 34   16                 pshs   d,x                     * B = signal #  E3AF E6   64                 ldb    4,s       XL  E3B1 BD   E542               jsr    xmtint    interrupt task  E3B4 35   16                 puls   d,x                     *  E3B6 30   89 00A2  20        leax   TSKSIZ,x  next task  E3BA 6A   E4                 dec    0,s       more tasks?  E3BC 26   E3                 bne    10b  E3BE 32   61                 leas   1,s                     *  E3C0 35   B6                 puls   d,x,y,pc  returnCPU09UIO   Intelligent I/O Proce     18:04:45  Jan 23, 2026   Page   27Generic Signal Handling Task                                                                  *                     * SI_HAN Signal interrupt handler                     *  E3C2 108E 0112     SI_HAN    ldy    #SI_Q     Terminal Interrupt Queue  E3C6                         seti  E3C8 FE   014E               ldu    SI_Q_ptr  get current Q ptr  E3CB 1183 0112               cmpu   #SI_Q     anything in Q?  E3CF 26   07                 bne    20f       yes - go process it                     *  E3D1 C6   D8                 ldb    #SIQPRI   wait for something to do  E3D3 BD   E50D               jsr    sleep  E3D6 20   EA                 bra    SI_HAN                     *                     * U[0]=int,U[1][2]=dev,U[3][4]=task                     *  E3D8 E6   C2       20        ldb    0,-u      B = Interrupt #  E3DA 34   04                 pshs   b  E3DC EC   C3                 ldd    0,--u     A = Device #  E3DE 34   06                 pshs   d  E3E0 EC   C3                 ldd    0,--u     task ID  E3E2 34   06                 pshs   d         save registers  E3E4 FF   014E               stu    SI_Q_ptr  update pointer                     *                     * S[0][1]=task,U[2][3]=dev,U[4]=response                     *  E3E7 E6   63                 ldb    3,s       set up to flush all input for this terminal  E3E9                         clri   allow     interrupts                     *  E3EB BD   E202               jsr    FIO_get   get access to FIO  E3EE EC   E1                 ldd    0,s++     task ID  E3F0 DD   0A                 std    fio_cpu1  E3F2 EC   E1                 ldd    ,s++      terminal #  E3F4 DD   0D                 std    fio_cpu3  terminal  E3F6 E6   E0                 ldb    ,s+       interrupt #  E3F8 D7   0C                 stb    fio_cpu2  signal  E3FA C6   07                 ldb    #R_INTRPT  E3FC BD   E1CA               jsr    fio_msg   send interrupt message  E3FF BD   E217               jsr    FIO_rel   release access to FIO  E402 20   BE                 bra    SI_HAN    process more if needed                                          *                     * Send_SI - Send a Signal interrupt                     *   B = Interrupt #                     *   X = task struct                     *   jsr send_SI                     *  E404 34   76       send_SI   pshs   d,x,y,u   save registers  E406 FE   014E               ldu    SI_Q_ptr  get Q head  E409 1183 014E               cmpu   #SI_Q_ptr check for overflow  E40D 24   0F                 bhs    90f       exit if so - sorry                     *CPU09UIO   Intelligent I/O Proce     18:04:45  Jan 23, 2026   Page   28Generic Signal Handling Task                          E40F EC   0A                 ldd    tsseq,x   task ID @ master side  E411 ED   C1                 std    0,u++  E413 EC   0D                 ldd    tsdev,x   device #  E415 ED   C1                 std    0,u++     place value in Queue  E417 E6   61                 ldb    1,s       old B  E419 E7   C0                 stb    0,u+  E41B FF   014E               stu    SI_Q_ptr  update pointer                     *                     * U[0]=int,U[1][2]=dev,U[3][4]=task                     *                     *  E41E 108E 0112     90        ldy    #SI_Q     wake up Queue server  E422 BD   E4E9               jsr    wakeup  E425 35   F6       99        puls   d,x,y,u,pc returnCPU09UIO   Intelligent I/O Proce     18:04:46  Jan 23, 2026   Page   29Scheduler  routines                                                                           *                     * All routines in this file pertain to scheduling                     * operations.                     *                                          *                     * change & rsched                     *                     * Change will change tasks.  The current task is put                     * back on the linked list of running tasks.                     * Rsched will reschedule the cpu giving control to                     * another ready task.  If no tasks are ready, idle                     * looping is done until one becomes ready.  Rsched                     * does not put the current task back on the ready list!                     * This routine returns one to the caller.  All registers                     * are destroyed.                     *                       E427 BE   0109     change    ldx    utask     point to task table entry >E42A 17   006D               lbsr   putrun    put on ready list                     *  E42D               rsched    seti   mask      interrupts  E42F BE   0109               ldx    utask     point to current task  E432 10EF 88 14              sts    umark0,x  save stack pointers  E436 BE   0164               ldx    tsktab    point to task table  E439 8D   23                 bsr    swtchu    switch users  E43B 7F   0111               clr    idle      reset idle/running flag                     *  E43E 7F   010C     rsche2    clr    chproc    reset change flag >E441 17   0025               lbsr   getjob    get a new task  E444 26   0C                 bne    rsche3    find one?                       E446 86   7F       05        lda    #127      set higheset priority  E448 B7   010B               sta    jobpri    set as current  E44B                         clri   clear     interrupts                     * idle work could go on here  E44D 12                      nop  E44E                         seti  E450 20   EC                 bra    rsche2    loop til find a ready one                     *  E452 F7   010B     rsche3    stb    jobpri    set new priority  E455 8D   07                 bsr    swtchu    switch users top page  E457 BE   0109               ldx    utask     point to task                     ** -- I don't think this will ever happen                     ** tst tssgnl,x any waiting signals?                     ** lbne sleep yes - this will blow task away...  E45A CC   0001               ldd    #1        return 1 to new task  E45D 39                      rts              return                                          *                     * Switch usersCPU09UIO   Intelligent I/O Proce     18:04:46  Jan 23, 2026   Page   30Scheduler  routines                                                      *   X - Task entry for new task                     *  E45E 35   20       swtchu    puls   y         get return address  E460 BF   0109               stx    utask     set up new running task  E463 10EE 88 14              lds    umark0,x  reset stack  E467 6E   A4                 jmp    0,y       return to caller                     CPU09UIO   Intelligent I/O Proce     18:04:46  Jan 23, 2026   Page   31Scheduler  routines                                                                           *                     * getjob                     *                     * Search ready list for ready task.  If none found,                     * return 'EQ' status.  Otherwise return task table                     * entry address in x.                     *                       E469 5F            getjob    clrb             clear      flag  E46A BE   0103               ldx    runlst    point to head of list  E46D 27   1F                 beq    getjo6    empty list?                     *  E46F A6   04       getjo1    lda    tsstat,x  get status byte  E471 81   01                 cmpa   #TRUN     is it in run state?  E473 26   1B                 bne    getjo8                     *  E475 5D                      tstb             first      in list?  E476 27   06                 beq    getjo2                     *  E478 EC   84                 ldd    tslink,x  remove from list  E47A ED   A4                 std    tslink,y  E47C 20   07                 bra    getjo4                     *  E47E 10AE 84       getjo2    ldy    tslink,x  remove from list head  E481 10BF 0103               sty    runlst    set new head                     *  E485 E6   05       getjo4    ldb    tsprir,x  get priority  E487 6F   84                 clr    tslink,x  zero out link  E489 6F   01                 clr    tslink+1,x so not run list  E48B 86   FF                 lda    #$ff      set ne status  E48D 39                      rts              return                     *  E48E 4F            getjo6    clra             set        eq status  E48F 39                      rts                     *  E490 1F   12       getjo8    tfr    x,y       save old pos  E492 AE   84                 ldx    tslink,x  follow link  E494 27   F8                 beq    getjo6                     *  E496 C6   01                 ldb    #1        set flag  E498 20   D5                 bra    getjo1    repeat loop                     CPU09UIO   Intelligent I/O Proce     18:04:46  Jan 23, 2026   Page   32Scheduler  routines                                                                           *                     * putrun                     *                     * Put current task on ready list.  The list is                     * arranged with higher priority tasks at the top.                     * If equal priorities are found, the new one is                     * put at the end of the block.  On entry, x points                     * to the task table entry.  All registers are                     * destroyed except x.                     *                       E49A 34   01       putrun    pshs   cc        save status  E49C                         seti   mask      interrupts  E49E 10BE 0103               ldy    runlst    point to head  E4A2 26   0A                 bne    putru2  E4A4 BF   0103               stx    runlst    set new head                     *  E4A7 CC   0000     putru1    ldd    #0        set last link  E4AA ED   84                 std    tslink,x  E4AC 35   81                 puls   cc,pc     return                     *  E4AE E6   05       putru2    ldb    tsprir,x  get priority  E4B0 E1   25                 cmpb   tsprir,y  look for correct prior slot  E4B2 2F   08                 ble    putru4                     *  E4B4 FC   0103               ldd    runlst  E4B7 BF   0103               stx    runlst    set new head  E4BA 20   0F                 bra    putru5    link in rest                     *  E4BC 1F   23       putru4    tfr    y,u       save last look  E4BE 10AE A4                 ldy    tslink,y  follow link  E4C1 27   0C                 beq    putru6                     *  E4C3 E1   25                 cmpb   tsprir,y  check priority  E4C5 2F   F5                 ble    putru4                     *  E4C7 EC   C4                 ldd    tslink,u  link into list here  E4C9 AF   C4                 stx    tslink,u                     *  E4CB ED   84       putru5    std    tslink,x  E4CD 35   81                 puls   cc,pc     return                     *  E4CF AF   C4       putru6    stx    tslink,u  E4D1 20   D4                 bra    putru1    go zero last link                     CPU09UIO   Intelligent I/O Proce     18:04:47  Jan 23, 2026   Page   33Scheduler  routines                                                                           *                     * makrdy                     *                     * Make a task ready to run.  Enter with x                     * pointing to task table entry.  If new tasks                     * priority is higher than current, set the                     * 'chproc' flag so the system can change tasks.                     *                       E4D3 86   01       makrdy    lda    #TRUN     set status  E4D5 A7   04                 sta    tsstat,x  E4D7 CC   0000               ldd    #0        clear events flag  E4DA ED   06                 std    tsevnt,x  E4DC 8D   BC                 bsr    putrun    put on ready list  E4DE E6   05                 ldb    tsprir,x  get priority  E4E0 F1   010B               cmpb   jobpri    higher than current?  E4E3 2F   03                 ble    makrd6                     *  E4E5 7C   010C               inc    chproc    set change flag                     *  E4E8 39            makrd6    rts              returnCPU09UIO   Intelligent I/O Proce     18:04:47  Jan 23, 2026   Page   34Sleep      and Wakeup routines                                                                *                     * wakeup                     *                     * Wakeup all tasks waiting the event designated                     * in the y register.  The x reg is preserved.                     *                       E4E9 34   57       wakeup    pshs   cc,d,x,u  save registers  E4EB                         seti   mask      interupts  E4ED CE   0105               ldu    #slplst  E4F0 AE   42                 ldx    tsslnk,u  point to sleep list  E4F2 27   0B                 beq    wakeu4                     *  E4F4 10AC 06       wakeu2    cmpy   tsevnt,x  check event  E4F7 27   08                 beq    wakeu5  E4F9 33   84                 leau   0,x       mark this entry                     *  E4FB AE   02       wakeu3    ldx    tsslnk,x  follow chain  E4FD 26   F5                 bne    wakeu2    end of list?                     *  E4FF 35   D7       wakeu4    puls   cc,d,x,u,pc return                     *  E501 34   70       wakeu5    pshs   x,y,u     save registers  E503 EC   02                 ldd    tsslnk,x  remove from list  E505 ED   42                 std    tsslnk,u  E507 8D   CA                 bsr    makrdy    put on ready list  E509 35   70                 puls   u,x,y  E50B 20   EE                 bra    wakeu3    repeat                     CPU09UIO   Intelligent I/O Proce     18:04:47  Jan 23, 2026   Page   35Sleep      and Wakeup routines                                                                *                     * sleep                     *                     * Sleep will put this task to sleep with priority                     * specified in the b register.  On entry, y is pointing                     * to the event which will be awakened.                     *  E50D 34   51       sleep     pshs   cc,x,u    save registers  E50F BE   0109               ldx    utask     point to task  E512 6D   08                 tst    tssgnl,x  any signals waiting?  E514 26   1F                 bne    sleep7                     *  E516                         seti   mask      ints  E518 E7   05                 stb    tsprir,x  set priority  E51A 10AF 06                 sty    tsevnt,x  set event  E51D 86   02                 lda    #TSLEEP   set status  E51F A7   04                 sta    tsstat,x  E521 FC   0107               ldd    slplst+tsslnk get head of list  E524 ED   02                 std    tsslnk,x  set new link  E526 BF   0107               stx    slplst+tsslnk set new head  E529 17   FF01               lbsr   rsched    reschedule cpu                       E52C BE   0109     20        ldx    utask     get task entry  E52F 6D   08                 tst    tssgnl,x  any signals waiting?  E531 26   02                 bne    sleep7                     *  E533 35   D1                 puls   cc,x,u,pc return                     *  E535 BE   0109     sleep7    ldx    utask     reset signal  E538 6F   08                 clr    tssgnl,x  E53A EC   88 16              ldd    umark1,x  stack reset point  E53D 35   51                 puls   cc,x,u    reset cc and registers  E53F 1F   04                 tfr    d,s       change stacks  E541 39                      rts              returnCPU09UIO   Intelligent I/O Proce     18:04:47  Jan 23, 2026   Page   36Sleep      and Wakeup routines                                                                *                     * xmtint - Send an interrupt to a task                     *  X - Task entry                     *  B - signal#                     *  jsr xmtint                     *  E542 34   76       xmtint    pshs   d,x,y,u   save registers  E544 A6   04                 lda    tsstat,x  get task state  E546 81   01                 cmpa   #TRUN     running?  E548 26   04                 bne    10f       no - try something else                     *  E54A E7   08                 stb    tssgnl,x  set signal  E54C 20   0C                 bra    99f       exit                     *  E54E 81   02       10        cmpa   #TSLEEP   task sleeping?  E550 26   08                 bne    99f       no - can't send interrupt                     *  E552 E7   08                 stb    tssgnl,x  set signal  E554 10AE 06                 ldy    tsevnt,x  wake task up >E557 17   FF8F               lbsr   wakeup                     *  E55A 35   F6       99        puls   d,x,y,u,pc returnCPU09UIO   Intelligent I/O Proce     18:04:47  Jan 23, 2026   Page   37Debug Interface Routines                                                   E55C               DB_main  E55C 8D   4F                 bsr    DB_test   see if debug routines present  E55E 6E   9F C002            jmp    [DEBUGROM+2]  E562               DB_pdata  E562 8D   49                 bsr    DB_test   see if debug routines present  E564 6E   9F C004            jmp    [DEBUGROM+4]  E568               DB_phex  E568 8D   43                 bsr    DB_test   see if debug routines present  E56A 6E   9F C006            jmp    [DEBUGROM+6]  E56E               DB_phex2  E56E 8D   3D                 bsr    DB_test   see if debug routines present  E570 6E   9F C008            jmp    [DEBUGROM+8]  E574               DB_pcrlf  E574 8D   37                 bsr    DB_test   see if debug routines present  E576 6E   9F C00A            jmp    [DEBUGROM+10]  E57A               DB_check  E57A 8D   31                 bsr    DB_test   see if debug routines present  E57C 6E   9F C00C            jmp    [DEBUGROM+12]  E580               DB_config  E580 8D   2B                 bsr    DB_test   see if debug routines present  E582 6E   9F C00E            jmp    [DEBUGROM+14]  E586 34   17       DB_msg    pshs   cc,d,x  E588 AE   65                 ldx    1+2+2,s   get return address  E58A EC   81                 ldd    ,x++      get mask word  E58C B4   0101               anda   DB_cntrl  E58F F4   0102               andb   DB_cntrl+1  E592 34   04                 pshs   b  E594 AA   E0                 ora    ,s+  E596 27   04                 beq    10f       jump if flag not set  E598 30   02                 leax   2,x       skip over false address & fall through  E59A 20   02                 bra    20f  E59C AE   84       10        ldx    ,x        get false branch label  E59E AF   65       20        stx    1+2+2,s   fix up return address  E5A0 35   97                 puls   cc,d,x,pc return                     *  E5A2               DB_pspace  E5A2               DB_outsp  E5A2 34   16                 pshs   d,x  E5A4 8E   E5AB               ldx    #00f  E5A7 8D   B9                 bsr    DB_pdata  E5A9 35   96                 puls   d,x,pc  E5AB 20 00         00        fcc    ' ',0                       E5AD 34   07       DB_test   pshs   cc,d  E5AF FC   C000               ldd    DEBUGROM  Debug rom present?  E5B2 1083 1234               cmpd   #$1234    special marker  E5B6 27   05                 beq    99f       yes - exit  E5B8 35   07                 puls   cc,d      no - abort DB_xx function  E5BA 32   62                 leas   2,s  E5BC 39                      rts  E5BD 35   87       99        puls   cc,d,pc   returnCPU09UIO   Intelligent I/O Proce     18:04:48  Jan 23, 2026   Page   38Debug Interface Routines                                                                                     E5BF  bad_cmd   equ    ****  Multiply defined symbol               E5BF  open_uio  equ    *               E5BF  close_uio equ    *               E5BF  req_write equ    *               E5BF  write_data equ   *               E5BF  req_read  equ    *               E5BF  read_data equ    *               E5BF  ttyset    equ    *               E5BF  ttyget    equ    *  E5BF 12                      nop  E5C0 39                      rts                                                                                                                                                                  E5C1  sdev_sig  equ    *  E5C1 39                      rts                                                                         end    rom_init7 Error(s) detected     8 Excessive BRANCH/JUMP(S) detectedCPU09UIO   Intelligent I/O Proce     18:04:48  Jan 23, 2026   Page   39Debug Interface Routines                            Symbol Table:Absolute Symbols:A        0008   B        0009   BSPCH    007F   CC       000A   CFGDAT   00E0   CLOCK    8070   CLOCKI   8071   CLOCKPR  FFC4   CNCLC    0018   CPU2DEV  0022   CPU_down E045   CPUtraps FFF0   CR       000D   D        0000   DBG_8274 0002   DBG_CMD  0100   DBG_HAN  0020   DBG_INIT 0400   DBG_INT  0004   DBG_IO   0010   DBG_MSG  0200   DBG_OPEN 0800   DBG_SLP  0040   DBG_SYS  0001   DBG_TASK 0080   DBG_TRMI 0008   DB_check E57A   DB_cntrl 0101   DB_confi E580   DB_iflg  0100   DB_main  E55C   DB_msg   E586   DB_outsp E5A2   DB_pcrlf E574   DB_pdata E562   DB_phex  E568   DB_phex2 E56E   DB_pspac E5A2   DB_test  E5AD   DBmsg00  E000   DBmsg01  E011   DBmsg02  E031   DEBUG    0D04   DEBUGROM C000   DEBUG_CO 0000   DEV2CPU  0021   DEV_SIZE 0006   DEV_UIO  E182   DLE      0010   DP       000B   D_CLOSE  0004   D_END    0026   D_GETD   0014   D_INTRPT 000E   D_OPEN   0002   D_RQRD   000A   D_RQWR   0006   D_SEND   000C   D_SETD   0016   D_TTYG   001C   D_TTYS   001A   D_WRC    001E   D_WRITE  0008   D_init   0022   D_inthan 0020   D_test   0024   D_ttconf 0026   D_ttdisx 002E   D_ttend  0048   D_ttenno 0034   D_ttenr  0030   D_ttenx  0032   D_ttenxr 002C   D_ttgetc 002A   D_ttisct 003A   D_ttputc 0028   D_tttstb 003E   D_tttstc 0042   D_tttstd 0044   D_tttste 0046   D_tttstr 003C   D_tttsts 0040   D_tttstx 0038   D_ttwcts 004A   D_ttwdcd 004C   D_ttxbsy 0036   E        000E   EOTCH    0004   E_ABORT  00BF   E_BADCMD 0081   E_BADDEV 0084   E_DEVBSY 0085   E_INTRPT 00BE   E_IOERR  0086   E_NTOPEN 0083   E_SOCKET 00C0   E_SYSBSY 0082   F        000F   FF       0040   FIFO_get E22D   FIFO_put E252   FIFOgeta E224   FIFOputa E24A   FIOPRI   000F   FIO_get  E202   FIO_lock 0150   FIO_rel  E217   HANGS    0001   HOLDC    001B   IF       0010   INTRC    0003   INTS     0002   IOPTDMIN 0009   IO_end   E348   IO_han   E2DE   IRQ_han  E366   IS       0003   IU       0002   IX       0000   IY       0001   MAX_FCMD 0010   MAX_TI   000A   MAX_TSK  0028   MIN_TSK  0020   MOD_SIZE 0004   NL       000A   NUM_CL   00E1   NUM_NEC  00E4   NUM_PPR  00E3   NUM_TRM  00E2   NUM_TSK  00E0   O_CLOSE  0010   O_INTRPT 0038   O_OPEN   0008   O_PGETD  0058   O_PSETD  0060   O_READ   0030   O_RQRD   0028   O_RQWR   0018   O_TTYG   0050   O_TTYS   0048   O_WR1C   0040   O_WRITE  0020   PC       0005   QUITC    001C   QUITS    0003   RAMend   6FFF   RAMorg   0100   RAMscrat 7000   RAMscren 7F00   REJECT   0080   ROMLOorg E000   ROM_ERR  E0CF   ROM_VERS 0020   ROMstack 7FFF   RUNPRI   0046   R_CLOCK  000E   R_CLOSE  0002   R_INTRPT 0007   R_OPEN   0001   R_PDATA  000B   R_RD1C   0009   R_RDOK   0005   R_READ   0006   R_READM  000C   R_REQOK  0003   R_RESET  000F   R_TTY    000D   R_WR1C   0008   R_WRITE  0004   S        0004   SIQPRI   FFD8   SI_HAN   E3C2   SI_Q     0112   SI_Q_ptr 014E   SPACE    0020   SYS_TABS 0168   TABCH    0009   TFREE    0004   TRUN     0001   TSKSIZ   00A2   TSLEEP   0002   TSYS     0005   TTYIPR   FFF6   TTYLOCK  FFDD   TTYOPR   FFEC   TTYSPR   FFE2   TTYTABS  0162   TWAIT    0003   U        0003   UIO_name E179   USTSIZ   008A   V        0007   W        0006   X        0001   XOFFC    0013   XONC     0011   Y        0002   Z0       000C   Z1       000D   bad_cmd  E5BF   cbufct   010F   cfreel   010D   change   E427   chproc   010C   clock_ti 0161   close_ui E5BF   cpu_fio  0000   cpu_fio1 0001   cpu_fio2 0003   cpu_fio3 0004   cpu_fio4 0006   cpu_fio5 0008   cpu_fioF 0024   dev_addr 0000   dev_brbu 0004   dev_tab  0168   dev_type 0002   end_vars 6FFF   fifo     0020   fifo_cnt 0012   fifo_get 0014   fifo_put 0016   fifo_us0 0018   fifo_us1 001A   CPU09UIO   Intelligent I/O Proce     18:04:48  Jan 23, 2026   Page   40Debug Interface Routines                            fifo_us2 001C   fifo_us3 001E   fio_cpu  0009   fio_cpu1 000A   fio_cpu2 000C   fio_cpu3 000D   fio_cpu4 000F   fio_cpu5 0011   fio_cpuF 0023   fio_dsz  E064   fio_fsz  E062   fio_irq  E26D   fio_msg  E1CA   fio_rese E1A2   fio_resp E1E6   fio_star E097   fio_wait E1B6   fiointe  E2DD   getjo1   E46F   getjo2   E47E   getjo4   E485   getjo6   E48E   getjo8   E490   getjob   E469   idle     0111   int_all  E392   int_buf  0151   int_ptr  015F   intret   E06C   irq_han  E069   jobpri   010B   lcbuf    0110   makrd6   E4E8   makrdy   E4D3   max_trn  E066   mod_name 0002   mod_tbl  E173   mod_type 0000   open_uio E5BF   putru1   E4A7   putru2   E4AE   putru4   E4BC   putru5   E4CB   putru6   E4CF   putrun   E49A   read_dat E5BF   req_read E5BF   req_writ E5BF   rom_bad  E0CD   rom_firq E0A0   rom_init E075   rom_int  E0C2   rom_nmi  E09A   rom_swi  E0A7   rom_swi2 E0AD   rom_swi3 E0B4   rom_trap E0BB   rsche2   E43E   rsche3   E452   rsched   E42D   runlst   0103   sdev_sig E5C1   send_SI  E404   set_tabl E0EC   sleep    E50D   sleep7   E535   slplst   0105   stbinit  E0DC   sto_chk  E10E   swtchu   E45E   sys_vars 0100   tsagin   0010   tscmd    0009   tsdev    000D   tsdtix   000F   tsevnt   0006   tskend   0166   tskinit  E11C   tsktab   0164   tslink   0000   tsprir   0005   tsseq    000A   tssgnl   0008   tsslnk   0002   tsstat   0004   tstval   000C   ttyget   E5BF   ttyset   E5BF   umark0   0014   umark1   0016   usp      0012   utask    0109   wakeu2   E4F4   wakeu3   E4FB   wakeu4   E4FF   wakeu5   E501   wakeup   E4E9   write_da E5BF   xmtint   E542   