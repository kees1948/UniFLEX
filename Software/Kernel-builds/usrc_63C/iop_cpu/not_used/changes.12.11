** update_all -- 13:55:12 Tue Dec 11 1984compare constants /usr0/uos-s5/iop/constantsCompare "constants" :: "/usr0/uos-s5/iop/constants"Window size = 3 lines***** File "constants" lines changed *****   21= DEBUG_CONTROL equ %0000111100111111***** File "/usr0/uos-s5/iop/constants" lines changed *****   21= DEBUG_CONTROL equ %0000111111111111Comparison complete: "constants" - 66 lines, "/usr0/uos-s5/iop/constants" - 66 linescompare init /usr0/uos-s5/iop/initCompare "init" :: "/usr0/uos-s5/iop/init"Window size = 3 lines***** File "init" lines changed *****  140=  stu TTYTABS point to tty table***** File "/usr0/uos-s5/iop/init" lines changed *****  140=  stu TTYTABS***** File "init" lines changed *****  336=  ldu OBUFRS output buffer  337=  ldx TTYTABS point to TTY Tables***** File "/usr0/uos-s5/iop/init" lines changed *****  336=  ldx TTYTABS initialize TTY tables  337=  stx ttytab point to tty table  338=  ldu OBUFRS output bufferComparison complete: "init" - 417 lines, "/usr0/uos-s5/iop/init" - 418 linescompare tty /usr0/uos-s5/iop/ttyCompare "tty" :: "/usr0/uos-s5/iop/tty"Window size = 3 lines***** File "tty" lines deleted *****   33= tregs rmb 8 copy of device registers (for 8274)Comparison complete: "tty" - 69 lines, "/usr0/uos-s5/iop/tty" - 68 linescompare tty_8274 /usr0/uos-s5/iop/tty_8274Compare "tty_8274" :: "/usr0/uos-s5/iop/tty_8274"Window size = 3 lines***** File "tty_8274" lines changed *****  110=  incb consume 2 slots  111=  leau DEV_SIZE,u  112=  bra 99f  113= 20 puls d,x,y,u restore registers  114= 99 clc no interrupt serviced***** File "/usr0/uos-s5/iop/tty_8274" lines changed *****  110=  addd #1 consume 2 slots  111=  leau DEV_SIZE,u  112=  clc  113=  rts  114= 20 puls d,x,y,u restore registers  115=  clc no interrupt serviced***** File "tty_8274" lines changed *****  125=  tfr x,y save device port address  126=  jsr ttftab get TTY table address  127=  lda #$18 send initialize code  128=  sta 2,y  129=  sta 3,y  130=  pshs d delay  131=  puls d  132=  lda 2,y check response  133= 00 ldu #cnfstr point to configuration string  134= 20 lda 0,u+ send to port  135=  beq 30f  136=  bmi 25f  137=  sta 2,y  138=  ldb ,u+  139=  stb 2,y  140=  lbsr S4_setreg  141=  bra 20b  142= 25 anda #$7F strip high bit  143=  sta 3,y  144=  ldb ,u+  145=  stb 3,y  146=  pshs x  147=  leax TTYSIZ,x  148=  lbsr S4_setreg  149=  puls x***** File "/usr0/uos-s5/iop/tty_8274" lines changed *****  126=  lda #$18 send initialize code  127=  sta 2,x  128=  sta 3,x  129=  pshs d delay  130=  puls d  131=  lda 2,x check response  132=  anda #$87  133=  cmpa #$04 check for "xmit buffer empty"  134=  beq 00f  135= ** -- Port not there!  136=  bra 30f  137= 00 ldy #cnfstr point to configuration string  138= 20 lda 0,y+ send to port  139=  beq 30f  140=  bmi 25f  141=  sta 2,x  142=  lda ,y+  143=  sta 2,x  144=  bra 20b  145= 25 anda #$7F strip high bit  146=  sta 3,x  147=  lda ,y+  148=  sta 3,x***** File "tty_8274" lines inserted *****  207= ***** File "tty_8274" lines changed *****  217= ttconfm0 fcc $d,'TTY Open Dev: ',0***** File "/usr0/uos-s5/iop/tty_8274" lines changed *****  217= ttconfm0 fcc $d,'TTY Open Device: ',0***** File "tty_8274" lines changed *****  224=  lbsr setupx do auto enable and DTR/RTS***** File "/usr0/uos-s5/iop/tty_8274" lines changed *****  224=  bsr setupx do auto enable and DTR/RTS***** File "tty_8274" lines changed *****  266= ttcnf4  267=  lda tbaud,x get port configuration  268=  anda #$1C  269=  lsra  270=  pshs u  271=  ldu #config_8274  272=  ldu a,u  273= *-- Set registers based on configuration  274=  lda #3  275=  ldb #$3F  276=  bsr S4_chgreg  277= *  278=  lda #4  279=  ldb #$F0  280=  bsr S4_chgreg  281= *  282=  lda #5  283=  ldb #$9F  284=  bsr S4_chgreg  285= *  286=  puls u  287=  lbsr reset reset pending interrupts  288=  lda #1 select interrupt cntrl reg  289=  ldb #$1F turn on interrupts  290=  sta cont,y  291=  stb cont,y  292=  bsr S4_setreg  293=  lbra S4true return true  294=   295= *  296= * Set 8274 register (image)  297= *   A - Register #  298= *   B - Value  299= *   X - TTY Table  300= *   bsr S4_setreg  301= *  302= S4_setreg pshs x  303=  if 0  304=  pshs d,x  305=  ldx #00f  306=  jsr DB_pdata  307=  lda 0,s  308=  jsr DB_phex  309=  ldx #01f  310=  jsr DB_pdata  311=  lda 1,s  312=  jsr DB_phex  313=  ldx #02f  314=  jsr DB_pdata  315=  ldd 2,s  316=  jsr DB_phex2  317=  puls d,x  318=  endif  319=  leax tregs,x  320=  stb a,x  321=  puls x,pc return  322=   323= *  324= * Update 8274 register  325= *   A - Register #  326= *   B - Mask of bits to save  327= *   U - Bits to be added  328= *   X - TTY Table address  329= *   Y - Port address  330= *   bsr S4_chgreg  331= *   U modified  332= *  333= S4_chgreg pshs b,x  334=  sta cont,y  335=  leax tregs,x  336=  leax a,x point to copy of registers  337=  ldb 0,x get old value  338=  if 0  339=  pshs d,x  340=  ldx #00f  341=  jsr DB_pdata  342=  lda 0,s  343=  jsr DB_phex  344=  ldx #01f  345=  jsr DB_pdata  346=  lda 1,s  347=  jsr DB_phex  348=  puls d,x  349=  endif  350=  andb ,s+  351=  orb ,u+  352=  stb cont,y set new value  353=  stb 0,x save in table  354=  if 0  355=  pshs d,x  356=  ldx #02f  357=  jsr DB_pdata  358=  ldd 4,s  359=  jsr DB_phex2  360=  ldx #03f  361=  jsr DB_pdata  362=  lda 1,s  363=  jsr DB_phex  364=  puls d,x  365=  endif  366=  puls x,pc return  367=  if 0  368= 00 fcc $d,'Set Reg: ',0  369= 01 fcc ', Val:',0  370= 02 fcc ', TTY: ',0  371= 03 fcc ', New: ',0  372=  endif  373=   374= config_8274  375=  fdb 00f 7 Data, 2 Stop, Even  376=  fdb 01f 7 Data, 2 Stop, Odd  377=  fdb 02f 7 Data, 1 Stop, Even  378=  fdb 03f 7 Data, 1 Stop, Odd  379=  fdb 04f 8 Data, 2 Stop, None  380=  fdb 05f 8 Data, 1 Stop, None  381=  fdb 06f 8 Data, 1 Stop, Even  382=  fdb 07f 8 Data, 1 Stop, Odd  383=   384= 00 fcb $40,$0F,$20  385= 01 fcb $40,$0D,$20  386= 02 fcb $40,$07,$20  387= 03 fcb $40,$05,$20  388= 04 fcb $C0,$0C,$60  389= 05 fcb $C0,$04,$60  390= 06 fcb $C0,$07,$60  391= 07 fcb $C0,$05,$60***** File "/usr0/uos-s5/iop/tty_8274" lines changed *****  266= ttcnf4 lbsr reset reset pending interrupts  267=  ldb #1 select interrupt cntrl reg  268=  stb cont,y  269=  ldb #$1F turn on interrupts  270=  stb cont,y  271=  bra S4true return true***** File "tty_8274" lines changed *****  478= setupx pshs u  479=  andb #$9F isolate important bits  480=  pshs b  481=  lda #3 select register 3  482=  ldb #$FF  483=  ldu #S4_auto set to restore auto enables  484=  lbsr S4_chgreg  485=  lda #5 select xmit control reg  486=  ldb #$60  487=  leau 0,s  488=  lbsr S4_chgreg  489=  puls b,u,pc return  490= *  491= S4_auto fcb $20 Auto enable mode***** File "/usr0/uos-s5/iop/tty_8274" lines changed *****  358= setupx lda #3 select register 3  359=  sta cont,y  360=  lda #$E1 restore to auto enables  361=  sta cont,y  362=  lda #5 select xmit control reg  363=  sta cont,y  364=  stb cont,y store pre-loaded configuration  365=  rts returnComparison complete: "tty_8274" - 750 lines, "/usr0/uos-s5/iop/tty_8274" - 624 linescompare tty_acia /usr0/uos-s5/iop/tty_aciaCompare "tty_acia" :: "/usr0/uos-s5/iop/tty_acia"Window size = 3 lines***** File "tty_acia" lines changed *****  103=  inc NUM_TRM -- bump by 2  104=  inc NUM_TRM***** File "/usr0/uos-s5/iop/tty_acia" lines changed *****  103=  lda NUM_TRM  104=  adda #2  105=  sta NUM_TRMComparison complete: "tty_acia" - 388 lines, "/usr0/uos-s5/iop/tty_acia" - 389 linescompare ttydrvr /usr0/uos-s5/iop/ttydrvrCompare "ttydrvr" :: "/usr0/uos-s5/iop/ttydrvr"Window size = 3 lines***** File "ttydrvr" lines changed *****   36= 10 jsr [D_ttconf,u] configure the port   37= * response of NE implies open OK   38= * if EQ then blocked by CTS if Carry is 0   39=  bne ttdop6 is it ready?   40=  bcs ttdop5 branch if blocked by DCD   41=  pshs cc,x,y save regs   42=  seti mask ints   43=  jsr [D_ttwcts,u] wait for CTS   44=  puls cc,x,y reset regs   45=  bra ttdopn repeat open   46= ttdop5 pshs cc,x,y save regs   47=  seti mask ints   48=  jsr [D_ttwdcd,u] wait for DCD***** File "/usr0/uos-s5/iop/ttydrvr" lines changed *****   36=  jsr [D_ttconf,u] configure the port   37=  bne ttdop6 is it ready?   38=  pshs cc,x,y save regs   39=  seti mask ints   40=  jsr [D_ttenx,u] enable xmit ints only   41=  ldb #TTYOPR set priority   42=  ldy tqout,x point to output q   43=  jsr sleep sleep on CTS***** File "ttydrvr" lines changed *****   91=  ldx TTYTABS point to table***** File "/usr0/uos-s5/iop/ttydrvr" lines changed *****   86=  ldx ttytab point to tableComparison complete: "ttydrvr" - 247 lines, "/usr0/uos-s5/iop/ttydrvr" - 242 linescompare vars /usr0/uos-s5/iop/varsCompare "vars" :: "/usr0/uos-s5/iop/vars"Window size = 3 lines***** File "vars" lines inserted *****   22= ttytab rmb 2 Pointer to TTY structuresComparison complete: "vars" - 53 lines, "/usr0/uos-s5/iop/vars" - 54 lines